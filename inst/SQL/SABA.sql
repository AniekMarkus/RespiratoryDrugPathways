CREATE TABLE #Codesets (
  codeset_id int NOT NULL,
  concept_id bigint NOT NULL
)
;

INSERT INTO #Codesets (codeset_id, concept_id)
SELECT 0 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (1154343,1138050,40798689,19053979,19068969,1125449,19028950,19035396,19063387,1236744,35198052,1181809)
UNION  select c.concept_id
  from @vocabulary_database_schema.CONCEPT c
  join @vocabulary_database_schema.CONCEPT_ANCESTOR ca on c.concept_id = ca.descendant_concept_id
  and ca.ancestor_concept_id in (1154343,1138050,40798689,19053979,19068969,1125449,19028950,19035396,19063387,1236744,35198052,1181809)
  and c.invalid_reason is null

) I
) C UNION ALL 
SELECT 2 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (43759505,43795491,43723536,43153708,43164725,43208530,43186627,43219535,35141811,35151703,43791769,43719875,43809929,35146592,35142501,21059867,21099174,21040247,35798380,40711761,40711760,35798356,35798367,36808751,36808765,35152324,35157608,21069806,44217407,44217413,21148220,21050035,44217347,21138368,21030427,43208924,43187048,43187049,43165128,43142964,41425048,41415608,41424053,41413864,41424218,41426565,41424217,41422509,43775457,43703675,43753786,43825905,43862131,43771804,43627892,41370347,41369097,41362370,41361317,41367868,41371085,41370188,41365023,41364305,41362368,41372150,41363108,41364874,41373215,41363109,41370187,41368792,41371859,41364304,41369577,41369576,41361316,41363831,41372874,41369862,41370186,41367134,41362367,41366385,41362366,41363421,41369096,41370623,41370185,41372873,41367563,41361584,41366384,41361919,41366037,41368634,41363830,41367562,41366036,41370184,41367133,41369861,41367867,41365282,41367561,41365281,41367132,41364172,41362365,41366383,41369095,41362364,41364555,41372149,41362856,41368791,41370346,41364302,41369575,36418583,36418582,36418581,41368287,41364554,41372148,41366828,41363107,41369860,41369094,36279382,36780030,36780029,36279913,36506576,36509331,43592103,41361582,41366035,41366034,41367559,41362082,43789876,41368013,41368633,41371697,41362081,43826102,41362855,43646225,43700250,41365277,41369858,41363105,41372869,41366827,41367560,41369859,41370622,41366381,41366380,41364872,41369437,41372872,41364873,41370924,41366033,41369092,43736138,41369091,41362363,43717983,41372871,41368286,41365279,41365625,41369436,41361581,41370923,43717986,43862365,43610052,43772056,43736137,43628121,43789877,43826103,43844181,43862366,43772057,43826104,43682232,41363106,41369093,41366382,41372870,41371698,43700251,41366032,43862367,41370621,43682233,43772058,41366826,43717984,43592104,41368154,41366705,41370066,41364753,41366481,41361998,41372527,41373305,41367955,41366704,41367754,41362581,41367753,41369314,41372743,41371216,41364752,41367025,41366258,41364751,41361454,41361456,41362228,41361801,41370818,41367211,41362784,41371797,41370278,41364958,41364959,41362786,41368725,41366482,41371798,41372528,41365706,41373306,41362785,41367956,41368936,41370065,41368508,41361455,41373100,41371571,43664350,43736091,43807938,43753960,43736092,43682188,43592054,43717939,43628067,43807937,43807936,43807935,43862308,43682187,43844133,41365138,41371534,41363270,41367723,41372512,41373290,41370784,41370031,41361277,41362960,41371979,41362199,41365137,41372304,41369272,41371533,41367722,41364239,41367940,41370259,41366218,41366671,41365456,41366990,41366670,41363663,41368460,41361766,41372516,41370032,41373292,41367724,41370264,41371009,41372306,41368904,41368114,41363662,41368902,41370785,41368456,41368710,41363492,41373055,41373291,41364402,41361764,41362540,41373293,41368711,41362200,41371980,41368459,41363273,41369509,41368718,41372515,41364949,41371788,41367206,41364247,41362769,41370462,41367393,41373054,41364240,41372305,41365457,41369505,41361166,41369273,41372713,41370033,41370786,41364947,41362766,41369506,41367201,41371007,41371786,41371006,41366470,41371785,41367945,41361765,41372307,41367198,41371784,41364946,41361991,41366469,41367200,41365698,41364945,41366468,41367199,41368715,41372712,41368115,41372711,41369275,41362767,41367202,43844132,43807934,43789827,43682186,43609979,43628066,43664349,43736090,43664348,41364403,41364025,41364024,41369274,41367941,41371005,41361990,41370261,41368714,41373298,41362765,41361989,41363493,41373297,41362764,41371004,41371003,41366991,41363271,41368712,41367944,41367943,41368713,41371002,41366467,41364243,41361988,41370260,41373296,41367942,41364242,41373057,41364241,41366466,41371783,41366465,41365697,41373295,41372514,41372513,41370262,41364245,41364244,41369693,41366672,41370461,41372710,41368903,41371879,41362096,41372893,41366853,41362710,41363572,41367579,41369449,43772079,43826117,43772080,43592123,43862382,43808006,43700266,43610068,43592122,43682249,43628139,43789900,43754030,43628138,43592121,41372574,41365010,41361571,41369076,41366371,41366536,41362062,41362061,41362350,41370609,41365269,41367859,41365612,40711714,40711713,40711712,36808999,36808996,36809000,40711717,40711716,40711715,36808998,36808997,36808995,43634439,43850344,43670552,43832332,43724213,43688394,43742363,43814242,43778248,43634441,43832333,40243202,40243203,41522335,41522499,40711973,40711972,40711971,36809024,36809030,36809031,41522280,41522285,40711976,40711975,40711974,36809021,36809029,36809035,35160891,35161128,41479518,41479501,41479527,41479512,41479487,41479525,41479606,41479514,41479513,41479572,41479531,41479635,41479664,41479641,41479656,41479647,41479675,41479674,41479630,41479666,41479653,41479668,41479721,41479683,41479692,41479689,41479684,41479685,41479712,41479680,41479720,41479694,41479693,41451310,41451299,41451295,41451301,41451306,41451297,41451294,41451309,41451312,41451308,41451304,41451296,41374400,41374467,41373824,41375916,41373768,41374084,41373607,41374374,41375003,41374466,41375688,41374211,41375097,41374373,41374293,41374465,41376051,41373896,41373823,41375985,41373895,41375857,41374793,41375772,41373656,41375096,41375353,41373583,41375541,41373655,41375494,41375493,41375206,41374048,41374863,41374083,41373894,41375037,41375915,41375639,41374150,41373928,41375402,41374468,41374375,41375689,41375773,41374241,41374754,41374753,41375321,41375320,41374638,41375004,41374712,41373658,41373657,41375319,41375543,41374152,41373739,41374294,41375470,43808275,41375205,43682521,43754314,43700563,43844451,43664670,43664671,43862661,43754313,43736411,41375669,41373962,41375843,41373713,41376034,41374739,41376033,41375222,41375428,41374814,41373600,41373590,41375016,41374552,41373755,41375476,41374551,41373908,41374880,41375787,41375182,41374062,41375330,41374550,41374061,41375475,41376059,41374060,41374722,41373622,41375377,41374961,41375728,41375830,41375062,41374962,36418538,41374816,41375429,41375132,41374883,44193370,41374723,41375790,41374220,41375789,41375332,41375331,41375788,41374882,36418539,41374771,41373951,41374595,41374516,41375729,41375623,41375792,41373911,41374384,41373756,41374383,41374015,41375926,41375622,41373910,41375791,41375333,41375019,41373585,41374221,41375334,41374111,41373623,41375061,41375892,41376018,41375621,41374515,41375279,41375659,41375224,43790198,43826428,43718298,43718299,43664717,43646588,43826429,43610357,43844492,43610358,43682571,43790199,35155561,35151981,43590077,43698215,43644270,43842131,43715979,43662338,43734089,43608045,43787880,43860342,43824060,43770006,35148191,35159226,35137202,35153211,41486867,41486112,41486762,41486800,41484523,41485904,41485799,41486395,41486003,41485265,41485474,41487222,41485689,41484440,41486447,41486866,43043769,43043770,43043771,35798573,35798582,35798556,35798586,35798591,35798508,35798490,35798581,35798504,35798494,35798553,35798562,35798595,35798543,35798527,35798563,36809374,36809351,36809367,36809361,36809368,36809347,36809354,36809340,36809375,36809358,36809371,43043760,43043761,43043764,43043763,43043762,40710862,40710852,40710851,40710854,40710853,40710859,40710855,40710861,40710857,40710858,40710860,40710863,40710856,43043765,43043768,43043767,43043766,46234464,41522644,44217932,44218045,44218092,21089279,21030457,43043757,41522766,44217824,44218093,44217853,21030462,21118753,46234508,44218079,44218139,44218097,44217981,44217992,44218027,44218046,44217934,21040281,21158229,44217926,44218095,44218128,44217991,41522707,44218091,41522643,41522659,41522676,44218096,41522672,44217892,41522600,41522712,41522607,41522650,41522623,44218044,41522799,41522637,44218129,44218138,36897501,21079589,21069839,44217980,44217893,21030459,21138399,43281723,41522612,21138398,21069836,21148256,21148257,43270845,21050066,21109018,21177705,21158227,21168002,21059901,21079588,21050067,21118750,43265357,41522693,41522744,41522651,44217933,44218094,21118751,21099204,21138400,21069838,21118752,21050069,1154660,1113078,1154615,42918919,42918918,41522790,41522781,41522679,41522717,41522731,41522792,41522746,41522638,41522608,41522669,41522689,44217884,41522780,41522779,41522725,44218047,44217894,41522683,41522682,41522614,41522745,41522678,41522668,41522695,41522754,41522677,41522763,41522646,41522704,41522694,44217847,44217993,41522658,41522601,35798540,35798511,35798512,35798548,21079585,21099202,21128524,21079586,21177703,36809343,40710448,40710447,40710446,21040282,21089280,36778148,36778146,36778145,36778144,36778147,36778143,36778142,36778141,35798572,35798554,35798596,35798491,43522491,40710896,36778152,36778151,35798564,36778153,35798568,35798532,35798598,35798531,35798584,35798520,35798530,35798528,35798529,35798565,40710906,40710905,40710904,40710903,35798555,35798509,36283941,36778150,36778149,36283940,40710902,40710901,40710900,40710897,40710898,40710899,43522493,36283935,36283936,36809370,36809357,36809344,36809376,36809377,36809350,36809335,36809348,36809360,36809338,36809355,36809356,36809333,36809342,36809378,785043,36809365,36809346,36809334,36809372,36809352,785044,785046,43043759,785047,785048,785045,43043758,785049,785050,40710390,40710389,40710386,40710388,40710387,40710918,40710917,40710914,40710916,40710915,40710879,40710878,40710890,40710872,40710871,40710889,40710892,40710895,40710893,40710891,40710894,40710888,40710887,40710886,40710885,40710884,40710883,40710882,40710881,40710880,40710877,40710876,40710873,40710874,40710875,44217809,44218048,44217885,44217855,44218073,44217816,44217854,21128526,44218099,21099203,21168001,44217815,44217935,44217814,44218098,35798607,40710870,40710869,35798574,35798546,36809369,36809337,44218074,44218083,44217944,44218001,44217982,44218000,44218082,44217999,44217943,44218104,40710439,40710438,785036,43043754,43043755,44217882,44217984,44217861,44217948,44217945,44218106,44218004,44218054,44217859,44218148,44218147,44218002,44217896,44217817,44217947,44217862,44217946,40710442,40710441,40710440,44217925,44217983,44217830,44217860,44217899,44218149,44217898,44218105,44217897,44218003,44218053,44217829,40710445,40710444,40710443,44217843,44218130,44218141,42918920,42918921,35143454,35162067,21050079,44217846,44218090,21138407,21168006,21069844,21128531,21030465,44217883,44217891,21138406,21177715,41487697,41487690,41487698,41487696,41487689,41487688,41487691,41487693,41487695,41487694,41487692,41487699,44208024,44208030,44208026,44207995,44208002,44208033,41377041,41380415,41377915,41379792,42920247,42920248,21117568,41376666,41379793,41379040,41380778,41379569,21147035,21068599,36809427,36809431,36809411,36895797,43844770,43700885,43754627,43682834,43754626,41380918,41380677,41381452,41377004,41377003,41382067,41378195,41378763,41379859,41381095,41381202,41379596,41380245,41377005,41381863,41376629,41378963,41382068,41379342,41376721,41376336,41377634,41380674,41380484,43610616,43844747,43808585,43718563,43772634,43754611,43718562,43844746,43790434,41380244,41380676,41380675,41382343,41377733,41377994,41376911,41377995,41377383,41381321,41376532,41379860,44193635,41379597,41381320,41381253,41380417,41376445,41380600,41377361,41378891,41377033,41381390,41377196,41380345,41378890,41377409,41378487,41381389,41378645,41378644,41379213,41380772,36809432,41378122,41380011,41376432,41380164,41465253,41465218,41465261,41465260,41465257,41465245,41465230,41465254,41465222,41465248,41465229,41465258,41465270,41465231,41465238,41465243,41465242,41465251,41465227,41465233,41465263,41465226,41465234,41465220,41465241,41465221,41465269,41465256,41465239,41465265,41465235,41465237,41465240,41465223,41465268,41465228,41465259,41465247,41465252,43634627,43760376,43832566,43670753,43688606,43616452,43670754,43868751,43616451,43796365,43850560,43688610,43814434,43688609,43778465,41465298,41465286,41465279,41465295,41465323,41465297,41465317,41465302,41465285,41465284,41465289,41465280,41465283,41465322,41465299,41465313,41465282,41465293,41465291,41465304,41465278,41465307,41465315,41465275,41465296,41465281,41465309,41465314,41465312,41465276,41465320,41465290,41465277,41465294,41465274,41465308,41465310,41465301,41465303,43868752,43742575,43832567,43670755,43598490,43814433,43652700,43706520,43598491,43688607,43778464,43760374,43796364,43868754,43760375,43652701,43616454,43724433,41465336,41465327,41465339,41465352,41465354,41465353,41465328,41465340,41465329,41465341,41465349,41465344,41465342,41465335,41465355,41465345,41465324,41465350,41465326,41465351,41465330,41465347,41465343,41465325,41465337,41465346,41465332,41465348,41465334,41465331,41465338,41465333,41465372,41465385,41465367,41465363,41465366,41465359,41465387,41465368,41465361,41465369,41465362,41465357,41465371,41465380,41465360,41465384,41465373,41465379,41465374,41465377,41465365,41465386,41465358,41465376,41465370,41465364,41465383,41465382,41465375,41465378,41465381,41465356,41487832,41487827,36417210,41487833,36417211,41487830,41487831,41487829,41487822,41487823,41487836,43613891,43668191,43631999,43793758,43650158,43775806,43811882,43775807,43829905,43739934,43632000,43757836,43775808,41465411,41465394,41465404,41465417,41465410,41465415,41465423,41465398,41465406,41465399,41465413,41465420,41465400,41465409,41465425,41465407,41465424,41465421,41465402,41465401,41465403,41465412,41465418,41465422,41465419,41465395,41465416,41465397,41465396,41465408,41465414,41465405,41488770,41488182,41489206,41488749,41489689,43866319,43757952,43596054,43793866,43793867,43668300,43812023,43668301,43632138,43686208,43848065,36897274,36897275,43742590,43634637,43760392,43832591,43754803,43665131,43772806,43647017,43610781,43610782,43187384,43220220,43220221,43154430,43187385,44135482,36896563,41431325,41431863,43632157,41431477,41431129,36896569,43812040,41431195,41431780,41431656,41431615,41431795,41431038,41431524,43757970,43596077,43596078,43848090,41431431,43775958,43866335,41431926,43830046,43614008,43830047,41431095,41431056,43757969,41431925,41431037,43632158,43668323,41431036,43740075,43668325,41431924,43757971,43866336,41431094,43740073,43775956,41431560,43848089,43793887,41431670,43721944,43668324,41431861,43686232,43704170,41431669,43740074,41431559,41431862,43830048,44198962,44198923,44198982,44199006,44198930,36896567,43830039,43830040,43614002,43632149,43848084,43704167,36896566,43668317,43812034,43757963,36896557,43775949,36896574,43614001,43686227,43793880,43650279,43668319,43596073,43596074,43686228,43812035,43650278,43848085,43721940,43668318,43775950,43632150,43632151,43830041,43668320,43830042,43721941,43848086,43668321,43632152,43614003,43704168,43721942,43757965,43614004,43614005,43775953,43632156,43812037,43848087,43757964,43775951,43632153,43775952,43596075,43686229,43812036,43848088,43793881,43632154,43632155,43830043,43793882,43793884,43757966,43793885,43740072,43686230,43614006,43830044,43830045,43812038,43668322,43812039,43793883,43704169,43757967,43775954,41431494,41431215,43757968,36896572,41431313,41431026,43614009,41431691,41431647,41431282,41431408,43793892,43668328,41431626,41431594,41431750,41431839,43775961,41431690,41431165,41431900,41431107,41431838,43775962,21138024,44135478,44135475,43259649,43292288,21147888,21069475,21098837,21079225,40717377,21118403,21069474,21098836,21128170,21118402,21030096,40717378,21030097,21059515,43292286,43276106,43265066,43286913,43297695,43292287,43259648,43259647,21049732,43187380,43281452,43259651,21157864,21069473,21059514,43292285,35788173,43297694,21088944,21138025,21088943,43292284,21157863,21147887,21108661,43270556,40717379,21039936,43259646,43270557,21108662,21039938,21088945,21167639,21167638,21108663,21059517,21039937,21059516,43176434,43198398,43143276,43154429,43187381,43209229,43286914,43281454,43265067,43281453,43297696,43292289,43259650,43276107,43198399,43209230,43165393,43281455,43292290,21069476,21177380,21167637,21079226,43259652,21118405,21128171,43187382,43187383,21118404,21147889,42921728,40717376,40717371,40717369,40717370,40717373,40717372,40717374,40717375,36809522,36809528,36809503,36809477,36809507,36809520,36809526,36809518,36809523,36809529,36809521,36809500,43039759,43039756,43039757,36809494,36809508,36809499,36809501,36809502,36809530,36809525,36809495,36809505,36809516,36809509,36809496,36809515,36809497,36809512,43039760,43039761,36809511,36809519,36809504,36809531,36809524,36809498,21167629,44135474,44135468,44135484,44135466,21167630,21138019,40717393,21030094,21049729,21177375,21098830,40717394,21039932,21079221,21177374,21128166,36281881,36281886,21069470,21108658,21098833,21167633,21118397,21088940,21069471,21098832,21177376,21167632,21128167,21108656,21108657,21167631,21098831,21039933,21088939,36281819,36281846,36281854,36281900,36281926,44135465,44135485,21030095,21128168,40717391,35788209,21079222,40717392,35788210,21039934,44135480,44135472,36896558,43866337,36896559,43668326,43632159,36896565,43793889,36896573,43775959,43596080,43866338,43686233,43668327,43596081,43757972,43740076,43632161,43721945,43793890,43830049,43632160,43775960,43793891,43596079,21157865,43286911,43286912,21147890,21069478,21079228,21108667,40717388,21157867,21118407,21108665,21069477,21108666,21128173,40717389,21088947,21059518,43270554,43281449,43286910,43276105,43259643,43297689,43292282,43276104,21177382,43143277,43292283,43297692,21088946,21049733,21128172,43259642,35788181,43281448,21118406,21098839,21098838,43265062,21030098,21157866,21108664,43270553,40717390,21177381,43259641,43259640,21079227,21039940,21167640,21039941,21177383,21098840,21059519,21069479,21030099,43220222,43198400,43198401,43176435,43143278,43198402,43281451,43259645,43265064,43297693,43297690,43259644,43265063,43297691,43143279,43198403,43154431,43270555,43265065,21098841,21039939,21088948,21147891,43281450,21059520,21118408,43154432,43165394,21079230,21079229,40717387,40717382,40717380,40717381,40717384,40717383,40717385,40717386,43039764,43039762,43039763,36809517,35139065,35134667,43812100,43686296,43704222,43866376,43812101,43614058,43632212,43614059,36809635,43039519,43039518,43039523,43039521,43039520,43039522,36809586,36809624,36809573,36809559,36809569,36809571,36809591,36809582,41490606,41492421,41492979,41490071,41491430,41491877,41492672,41491570,41491623,41522857,44218214,44218191,44218203,44218213,44218231,41522844,44218233,44218232,44218242,44218230,44218253,41522854,41522836,41522843,44218202,44218260,44218252,44218200,44218229,44218241,44218228,41522835,41522851,41522852,41522842,41522853,41522858,41522839,44218269,41522847,41522848,44218268,44218251,44218217,44218250,40710234,40710233,40709814,40709813,40709812,40709811,41522856,44218212,44218216,41522840,41522841,41522850,41522834,44218227,44218211,44218262,44218224,40173416,40173417,43845031,43610902,43592959,43701162,43718879,43718880,43790729,43808888,43629060,43647139,43592958,43259205,43264618,43275673,43291837,41385273,41389403,41386262,41389181,41388688,41384894,41388550,41387975,44194766,41389182,41388070,41389485,41388631,41388069,41385567,41388428,41385401,41387135,41386093,41385210,41386092,41386145,43758535,43650851,43686775,43670896,43850694,43652827,43778609,43868893,43652828,43796510,43742706,43724601,43724602,43830648,43830649,43722552,43776585,43650861,43740686,41490023,41490031,41490028,44218294,44218296,44218295,40173433,40173434,40709703,40709700,40709697,40709699,40709698,40709702,40709701,21099209,21099210,21059910,21089287,21030468,21040287,21089286,40713725,40713724,40713723,36809784,36809780,36809782,40713728,40713727,40713726,36809781,36809785,36809783,41439878,41439874,41439883,41439880,41439879,41439882,35419351,35419350,35419352,35419348,35419349,36809819,35414213,35414216,35414217,35414214,35414215,41398119,41400210,41396684,41400211,41395477,41440358,41440360,41440362,41440364,41440361,41440355,41440359,41440357,41440365,41440356,41440363,41358276,41351845,41352598,41355809,35158229,35131132,21089242,21128483,21040240,21158185,21148215,21089243,21040238,21040239,21108985,35798224,35798280,35798322,35798234,35798273,35798235,35798287,40713427,35798286,35798248,36810189,36810199,36810193,36810186,36810191,36810182,36810190,36810185,36810188,43867640,43723279,43669579,43777322,43597374,43741413,43831353,43687501,43741412,43651600,43633521,43615349,43777319,43615350,43867642,43777320,43831352,43651602,43723276,43687499,43651603,43597372,43741411,43669577,43813365,43705421,43867643,43597373,43615351,43705422,43723277,43687500,43777317,43651601,43759242,43867641,43687498,43759241,43777318,43705420,43741450,43651639,43687537,43597411,43723317,43669617,43737829,43864122,43864123,43755782,43719693,43864121,43755797,43737842,43719715,1154617,40163919,40173455,40173456,43597541,43795417,43867821,43831545,43651774,43651775,43687686,43777522,43795419,43615524,43615525,43723475,43867822,43795418,43597542,43777520,43813546,43669782,43633725,43615523,43777521,43669780,43651772,43597540,43705596,43651773,43615522,43777519,43633724,43795416,43849634,43705597,43687685,43777517,43669781,43777518,43759440,43813545,43687684,41476292,41476295,41476289,41476291,41476290,41476298,41476300,41476294,41476297,41476293,41476296,41476299,35137405,35150965,43724716,43778761,43652969,43869027,43832846,36221811,36236443,1154343,43729027,43764910,43585027,43855148,43764911,43837210,43837211,43729028,43675404,43800919,43800921,40890530,36881999,41308356,40871694,43746966,43855154,41270993,43657267,43855156,43764913,43855155,43693125,43657266,43657265,43621030,43729031,43603063,43746965,43639189,42718772,42716339,42724587,42725032,42719691,42727298,36891151,43783072,36882000,43764903,43675401,43675400,43800915,40859217,43603059,40996446,40840586,41183986,41271003,43855144,40927619,43819049,41302085,43837207,40996429,40840559,43819050,43800916,43639184,43621023,43621024,43764901,43764902,41264823,43675399,43855143,43783073,43693117,43746959,43621025,43783075,43764907,43729024,43746962,43783078,43764905,43657259,43603060,43783076,43693118,43783077,43819051,43746960,43657261,43855145,43746961,43819052,43621026,43639185,43675402,43603061,43657260,43657258,43783074,43800920,36882904,43621028,36885826,43621029,43855150,43711034,43585029,42725432,42721973,42728611,42715192,42713008,42723712,42729048,42710388,42715645,42726393,42730961,42719013,36884337,43584114,36885825,43763993,43692223,43692224,43763994,43799999,43855157,43657268,43675407,43657269,43819054,43675408,43639190,43675409,43711037,43746967,43621031,43585030,43764909,43693120,43657264,43729029,43800917,43585028,43639188,43729030,43693122,43855149,41044572,41021137,41177655,41177654,40958906,41271002,40865427,40965133,41121444,41090200,40871715,41058641,40965132,41246328,41115164,40990152,41277210,41090225,41140394,41077617,41075959,41302090,41146729,41152960,41308363,41109045,42730726,42717946,42717945,42726395,42715646,42710999,42729440,42724586,42719266,42713007,42719690,42729911,42721972,42718400,42725030,42712368,41075958,40865437,41021129,41058620,41121425,40927624,41177647,40902729,41246313,41203006,41169935,41177640,41209176,40840553,40933908,40890525,41013466,40958902,41240134,40896626,41270992,41152951,41183980,40840563,40824590,41146725,40927618,41277182,41215304,40827962,41109040,41169936,41052324,41146727,40871685,41058611,41140385,44065570,44109782,44059881,44126985,44105534,43855138,43800904,41052334,41302096,41308373,41277206,40871706,43764897,40890539,43800903,40888910,40983807,40865445,41308376,40996445,41215331,41090224,41052336,41209185,41302099,44104273,44058226,40896633,44072709,44101006,44027879,44026544,44083987,44111349,44049386,44053907,36890189,43729025,43729026,43621027,43693119,43837208,43585025,43639186,43657255,36893701,43783071,43621019,43800905,35157926,43783068,43783067,43657252,43800906,43657253,43800907,43783069,43783070,43603052,35153732,43746954,43746953,40888909,41234024,41146728,41277191,41121426,41177648,41302089,40865438,40902730,41183991,40965119,41215311,40871698,41090212,41246315,41058621,41246314,41215310,40965118,40952680,41295895,41046221,40859211,40859210,42722763,42731199,42725033,42712369,36886266,43657263,43675403,41115166,40871721,41295900,43855147,42722762,42720613,42725031,42724344,43692222,36883893,43638253,42711256,42710387,42713629,40919909,41115153,40927615,40902720,41183977,40921497,43837204,41052327,41121418,43800913,43837205,43675396,40927623,41027451,40827966,43819047,43603056,41234023,43855146,43746963,43764908,43657262,43746964,43585026,43639187,43800918,43693121,43837209,19108688,41203010,43729021,43819048,43639183,43729022,43675397,43711032,43657256,43746957,43746958,43693116,43675398,41209187,40996453,41308382,41209186,41021139,40958907,43603057,43800914,43800908,43675393,43764899,43800909,41271005,43855139,43764898,43585021,43585022,43693112,43675392,41201352,41264825,1154497,40896627,41240135,19117781,19115871,36814076,36812649,43036316,43036317,35767040,36404828,35750395,35769395,35750394,36406343,35754632,35752686,35754631,35769382,35758743,36404049,36407887,36406341,36404829,36407888,36812437,36814053,43036314,43036315,589320,40723760,40723759,40723762,40723761,40723767,40723763,40723305,40723765,40723766,40723768,40723306,40723764,44111348,590456,44087996,44092613,43036313,43172437,1154459,44175651,43268394,21091535,44066924,41234021,36880735,21022904,43257509,44186905,46234465,41152954,21052335,21072078,40825771,21081770,21120944,46234509,44169300,44165489,44188012,21052345,21032660,40933913,44180490,41058614,41246308,41308354,41027449,41246307,44180492,21052341,43279281,36881998,44176808,21052344,21160452,44188011,21140663,21130711,43295524,44176807,40865429,40865428,21022905,21022906,21160450,21140662,43268395,21160451,21150503,21062170,21111261,21062169,21111262,21062171,21120942,21072085,43279285,40871692,40902727,44180491,41152956,41058616,44173036,44184224,44165488,41090205,41152955,40902726,41058615,40933912,41215308,44188010,44188009,21062173,21052343,21170240,21140664,21150504,21042575,19021327,42902622,42902809,42903088,44072708,44062395,44111357,44101010,42902448,42903179,44072713,44085591,44049395,42902903,44118522,46234506,19044359,44118521,44027884,40890529,44175650,44168195,21120941,44168194,40890528,44183150,44179435,44160601,41109038,41295894,40983799,41015036,44186904,40859208,44186903,19131110,43161456,43194368,43183355,43216221,43205323,43139334,42931130,42931129,41138837,40865433,40996433,40871696,41270994,41277189,40840565,44173038,40965112,41277188,41090209,41277187,40996432,40902728,41121419,41183988,41246312,40965111,44173037,44084296,44125109,44037182,41052328,41121422,40921504,41171570,41052335,41184006,40996443,41101643,40840581,40933931,40840580,41152975,41115162,41240138,41115161,40840585,41058640,41101645,40902744,40871714,41215330,41215329,41215328,41277209,40840584,41101644,41027462,41058639,40990151,40896635,40896634,41184007,41215327,40840582,41308375,40851975,41277208,40902745,41308374,40896636,41271001,40840583,40933932,41264832,40983806,41077616,41203009,41140393,1154533,1356174,1154496,36812499,36814532,43516247,35746368,35770130,35745021,35770131,42481993,21109766,21168748,21109767,21090034,36810441,21041054,21022908,40733112,40733111,40733110,21032662,21111266,36782804,36782802,36782801,36782803,36782800,36782799,35771371,36407152,35771370,43516049,40723358,36782806,36409430,36782807,36406347,35748545,40723369,36405579,35769386,35746252,35769385,36404050,36404830,36406342,40723368,40723367,40723366,40723365,35758744,36405578,36275318,36782805,40723364,40723363,40723362,40723359,40723360,40723361,43516871,36270209,36813940,783971,783973,783974,783972,783975,40727739,40727738,40727735,40727737,40727736,40727732,40727734,40727733,40243275,42903409,42903280,40723341,40723340,40723352,40723334,40723333,40723351,40723354,40723357,40723355,40723353,40723356,40723350,40723349,40723348,40723347,40723346,40723345,40723344,40723343,40723342,40723339,40723338,40723335,40723336,40723337,36808844,36811622,36812757,36261553,36271766,36811920,43161464,41152964,41277197,43205332,40990149,40945519,40976481,41146730,43194378,40945520,40927626,41101639,40927625,40871700,41215315,41121430,40914159,41257553,41101641,41183993,40914160,41152965,41007827,40871699,40840572,41257552,41277199,41058623,41226704,40965122,41027453,40933920,41152962,41215313,41277195,41152961,40851971,40851970,41101638,41101637,41277194,41277193,40883238,41132969,40883237,41195640,41164319,41038890,41101635,41038892,40851969,41101636,40824393,40840570,41070188,41038891,40840569,41288599,43183362,43172449,43150282,43172450,43205333,1154453,44096904,44059880,44049384,40865440,41240137,41320009,40851973,40834321,40990148,41101640,44111346,44049383,40933922,40933921,40902732,40851972,41320008,40914158,41257550,41090214,41257551,41164320,44085587,44036265,44124545,44087989,19101999,41240131,40958900,41015035,1154541,19120958,1154536,19098332,40826318,41263154,44176095,44176810,41115163,44184226,41246329,44183151,41234027,41021126,41021125,41027439,41277180,41257546,41007826,41083928,41270988,41302082,40965103,41308349,41183978,41308348,41109036,40921498,41264822,40951060,41052322,41302081,40871681,41121413,40921496,41234017,1356110,36814286,42479850,21081768,21042568,21042566,21042567,44184225,44169301,42479248,21170237,21140658,21081767,21120938,21140657,21111259,21170236,40723319,40723318,35771372,35765169,40723315,40723314,35754634,35769390,40723317,35752691,35748547,35744337,35756901,35744339,40723316,35744338,35769389,36810848,36814745,36811042,36814057,36811224,21109769,21031158,21060635,21139161,21070622,21031159,21150488,41271000,21062156,41240133,21062157,21101418,21101419,40896625,41257549,40865430,21101417,40927620,41177641,41132968,21032656,41152957,40871693,41288598,41027450,40851968,41184005,41215326,41288604,41152974,41058638,40965107,40933914,41277186,41308355,21032657,21062159,21052333,21120933,21052334,21022896,21091528,21062158,21022895,21160443,21081763,21170232,21111256,21140656,21052332,19072359,40164006,44032256,35754087,35754085,35770836,35761056,35745707,35761057,35754637,35775534,35752695,35746253,35752694,35771373,35756904,35761054,44059882,35750396,35744341,35754639,35748549,35769399,44049387,19086690,1356112,40982202,41177646,41177645,40896629,40990147,40865436,19099825,19120957,1154535,19098331,40919910,40982203,40865439,41308365,41109046,40927616,41270989,40902721,41246303,40890526,1356116,36810759,40723330,36811280,36810435,36813731,21060633,21060634,21041055,21031157,21139160,21119498,21042577,40865431,21160453,40834320,21140665,21111264,21081772,41302092,41257554,40834319,21091536,41209178,41115154,41288594,21042578,41308368,41090217,41164321,41058608,41257547,41246310,40871695,41277183,41090197,40823966,40965105,21150506,21081774,21091538,21052346,21160454,21170241,21111265,21062175,21150505,21140666,21081773,21091537,21022907,21062174,21130713,19004125,44071120,35766521,35766520,35775083,35744333,35770834,35756895,35754630,35754629,35773761,35750392,35748538,35750393,35761051,35769381,44124547,35746251,35765164,35771369,35748539,35744332,44049393,19085818,19116924,44079614,44092614,19044360,21140660,19115323,35151522,19054320,42724123,42721974,42715193,42721087,42726394,42728326,19086687,44118519,41046230,36880076,44098518,44126989,41058644,41277213,41090227,41308378,41052337,40865446,40896637,41021138,43172442,41083938,40834322,40933933,40996448,41277212,41121445,41027463,44098517,44062401,44046875,44062400,44085588,44101008,41215335,41184010,41215334,41215333,41277211,41308377,40902747,41090226,41058643,41246330,41184009,41058642,40871718,40902746,40871717,40871716,40996447,41215332,43150279,43205327,41109050,44040857,44066927,44118518,40859219,40952682,40859218,43161460,41015042,41015041,43139337,40983808,19117782,41046229,19115872,36886265,41140391,36884824,40902737,40825834,43711030,41021132,41209181,36882001,43675394,40927627,41302091,41270997,41277203,40996439,41090216,43603054,43746956,40871702,43837203,41277202,43855140,40933923,41246319,41277201,41121431,43819045,41058625,40902735,43729020,41215318,40902734,43621018,40871701,43639182,40965124,41277200,41246318,40827968,43800910,41109047,40983802,43837202,41203007,40890538,40983801,40921503,40890537,41075957,44172391,44179871,44176806,44165487,40859206,19103065,43560453,43560451,43560452,1154501,19053005,19120386,19123989,1154373,1154374,19123990,40164014,19044358,40164015,36887206,43837196,36883894,43729012,43675388,43837198,43585018,43783065,43746948,36882902,43800901,43855135,43693107,36893700,43819038,36887750,43764893,43675389,43657249,43693108,43729014,43675390,43783066,43729013,43764894,43855136,43729015,43729016,43746949,43693109,43585020,43837200,43675391,43729017,43764895,43585019,43800902,43603051,43837199,43819039,43746950,43746951,43746952,43764896,43657250,43639178,43855137,41058618,41246309,43729011,43585032,36889752,40897884,40835657,43729034,40844650,41125490,43855161,40875846,41031528,40906753,40875845,40821820,43837214,41078381,41171569,43675387,40827965,43693106,41234022,35146942,35155935,35132343,35139460,19096013,19108686,19093833,44066929,44079613,43290098,41046218,44040856,43273911,44027880,44072714,44062403,44098516,43268402,43273912,44059884,44036268,21101415,43279287,21052330,43205324,43295529,43273913,44062398,44087993,44098515,44101007,21130706,21170230,44072711,44062397,44098514,44036267,44098513,44049392,44124546,44049391,44111352,44049390,21140654,21081762,43172439,43183357,43194370,43183358,43273914,43279289,43279288,43290100,43216222,43139335,43290101,43257513,21072076,43262897,21052331,43205325,42931131,40723312,40723313,36812024,43036320,36814673,44026104,21099391,44034431,44099163,44123231,21030633,21030634,36273092,21118934,44127924,21089484,21148465,36268008,36265427,36262865,44111925,21138591,21118935,44060504,21138590,36259084,44041403,21109241,44028421,43011917,21120932,44053911,44040855,44025322,44053910,44066925,21081761,41295893,19115322,43183356,43150276,43194369,43172438,43290099,43284695,43161457,19117783,41203003,43279286,19115873,36811387,43172441,41171568,41138836,41015034,41021127,40996427,40871683,41101634,40976478,40851967,41183983,41288596,41226703,40914157,41183982,41101633,41132967,40914156,41146726,41164318,41115155,40958899,41152952,40902723,40851966,41027444,40976477,40824903,40883236,41215305,41183981,41195638,41101632,40996426,41288595,41195637,40840556,41090199,41038889,41246305,40914155,41090198,41257548,40933906,41277179,40851964,41215303,41164317,40996425,41027442,40883235,41058609,41226702,40840555,40851965,40871682,41027441,41027440,41302084,41302083,40871684,41027445,41288597,40827963,41203004,40983798,41234019,41203002,41109037,41234018,36884336,36882901,43819053,36888752,43711035,43603062,36882900,43855151,36885824,40965108,43675405,43855152,43675406,43693124,43855153,43837212,43764912,43711036,41046220,43693123,1154460,44118517,19117777,19117776,1154572,44027878,40859214,43279282,41140390,43262893,44111347,44049385,41246317,41152966,43262895,43268396,40902733,41146731,41052330,21081769,43257511,41177649,21062165,43183360,43268398,43268399,44062393,21120940,21052339,44098511,44126984,44046871,44126983,44072707,44087991,44046870,44087990,21072084,21150501,40840573,43205328,43172445,41090215,41027456,43216223,43194376,43290094,43268400,43295526,43268397,43205329,43194377,41058624,41183994,41215316,43290095,43284693,21062166,21101426,43257512,21042570,43139339,40723331,40723332,19060972,36810836,21120939,44027877,44079612,44066923,44040854,35159500,21091533,41046224,43183359,41015039,41015038,43161462,43262894,43295525,43194375,41140389,43257510,21091534,36814166,44053909,44118516,19044391,44118515,40952679,19115320,43205330,42931128,19117775,41264827,35159748,19054317,40857603,41294332,44160600,41270991,44188008,41270990,41058607,41058606,40952677,40927629,40927628,41115157,41115158,40840575,41308369,41164322,41058628,41121432,40851974,41090218,41058627,41007828,40902738,41195641,41277204,40840574,41183995,41215319,41264829,41046227,41109048,40859215,42931121,42931122,42931123,42931124,19108687,44118520,44066928,21170238,44085590,44075130,44033852,44101009,41115156,41021130,40896630,36419560,44124548,44049394,44111356,44075129,40933919,41215312,36419559,36419558,43855142,43290097,43284694,41308364,40965121,41246316,41027452,44111355,44062402,40902731,41277192,40965120,21150500,36782812,21042569,44079615,44027883,44027882,40921501,36419561,43819046,43290096,40890536,44053912,40952681,21140659,1154458,44079611,19117780,19117779,41046228,44066921,44053905,19044392,44079610,41264831,19115321,42931120,42931119,19117778,40890540,40983804,19054318,40827969,19023013,19035039,1356125,1356126,1154380,19130040,1154656,35131371,1154655,36813544,1356127,35138141,1356128,36894124,40890527,36892712,41308353,41058612,41277185,40871690,41302088,43855158,41302087,43819055,41209179,43639191,41302086,43711038,36881044,43603064,41246306,41090203,41308351,40933910,41090202,40824280,41058613,41215307,40902725,41090201,40871689,43585031,40996431,40996430,41121415,40871688,41183985,41308350,43800922,43657271,43855159,43675410,43639192,43675411,40902724,40840560,40933911,43729032,40871687,43693127,41277184,43819056,40871686,43639193,40952678,41077614,40921500,43621032,41264824,43837213,43783080,41234020,43693126,1154499,40859216,41109049,41264830,41203008,42931126,41140392,41295898,19115870,40983803,19023012,19120951,36894125,43764900,36214218,36214219,42483138,21041053,36812530,36813445,40733114,40733113,46234463,40987340,36782815,40987339,21101413,36887600,41112320,43657248,21101414,41237311,46234507,21022894,41206450,41268317,41237314,40862672,21072075,40893849,41206448,44179628,41018326,41018325,40831435,40831434,41018330,41299316,43205321,42480990,42480426,36214222,36215321,36215522,1356111,36814137,36811043,36813190,36813195,36814529,36813268,36813891,36811307,36811372,36813045,36814698,783970,36810717,1356113,36812524,36812404,1356108,1356109,1356117,35137878,43036312,1356118,36811728,1356119,36810970,35156586,35148127,1356122,36811825,36215523,40727741,40727740,36215322,1356123,36812203,1356124,36813156,783785,36812756,40142665,40142666,36215519,36215520,36215521,40142703,40723381,44056680,40723378,40723379,44121273,40723380,44095369,44082376,46234512,40142705,44043683,44108217,40723384,40723383,41018328,40723382,44095368,35757988,40151684,42931133,44108215,36215524,36215525,36215526,36215527,36234409,36234172,36234173,41235897,1138050,1138095,19074278,1138051,19063706,1138096,19074277,19048151,19063707,36224016,1356138,1356139,1356136,1356137,36229426,36229428,36229429,36231359,36231360,36231361,41204873,41266713,36213198,36213199,36213200,36222849,36222850,36222851,36222875,36222876,40798689,41139755,40954417,41170910,41055588,41212309,40899710,41098388,41098387,41223356,41266566,40920866,41297577,40986621,40926342,36237526,36237527,36219436,41047702,41297346,41117858,41253335,41191278,41097346,41065817,41211810,40891918,41086572,41222363,41047701,41086571,41097345,40954166,41235397,41242726,40909877,41128680,41284321,41160127,41003561,40836937,41023800,41180401,41235398,40836938,40961583,40909880,41003562,40922895,41297345,41211808,41253333,41315588,41160125,41315587,40836936,41149313,40972208,40941248,41128679,40847761,41211809,40954165,41242725,41160126,41273628,41211811,41191280,41222364,40961582,40847762,41065816,41055048,40909878,41253334,40986515,41082356,41205663,41145166,41050836,40861866,41113592,40895114,40832715,43819643,43819644,43783653,43676008,43621601,43801527,36219499,36237787,36237788,36237789,19053979,41263826,40953805,41023103,41189796,36419986,41189795,36419987,41085953,43638700,43818574,43746514,43728595,43584560,43764443,43710587,43746511,43602575,43692649,43764445,43800449,43764444,43602574,43800448,43710588,35158217,35132159,41294931,40953804,41054365,41158611,40846322,41242071,40858281,40922588,41272966,40908459,41158614,41272965,40891609,40929609,41251938,41127152,41272962,41263825,40922586,41110171,41179732,41095923,40846320,41095922,40908457,40877449,41023098,41179731,40898507,40836320,41033184,40939699,41002116,41189787,41064345,40891610,40953803,41242070,41002115,41127153,41211171,40827007,41204144,41242076,41158615,41033187,41282814,41054368,40867402,41170608,41110172,41211172,41095924,40939700,41023099,41139467,40984977,40984976,40960954,41127155,36419984,41064351,41189792,41282815,36419985,40836326,41242077,41014146,41172620,41016085,41242080,41282819,41095928,41282809,41220957,41282808,40898511,40898508,41148649,41023100,40877450,41220949,41127154,41023101,41158612,41220950,41314102,41148645,41054366,43710586,41172618,41110173,40951679,41141536,41211176,41189794,41314108,40992192,43200457,36812489,44183804,44181136,44166196,44177422,40727828,40727827,783780,43034241,43145331,43167453,43200458,43145332,43200459,43200460,43836753,40829099,41148646,41189790,40970740,40846323,40846324,40939701,40836323,40960952,41242073,41179733,41047379,40960950,40970739,41002114,40867395,43800443,43200456,36811587,44168884,44188714,44188713,40727831,40727830,40727829,44058727,44034663,44115119,40922585,43167454,43211266,40877448,40939698,41220947,40908456,41304069,43156522,41148643,40929608,43200461,43189428,43156523,19054032,44053131,36810411,40727837,40727836,40727835,40891612,40929614,41282817,40939705,41136198,41033189,40846325,41229878,41260652,41242078,40960956,41304072,44123394,44034664,44050682,36810313,36811310,19091094,43782575,41110174,36882004,43602573,43800444,43692648,43620587,43638699,40891611,41189789,41220948,41158608,41064344,41064343,41033185,35157112,43800445,43638701,40858282,41078772,41085951,41189793,40846326,40992191,41265971,41148642,41282806,44175609,44160648,44187566,44162373,41117166,41158610,41189788,41158609,41272963,40824959,19054010,44028625,42937994,35133541,35132330,40858283,41047381,41211175,40908462,40877456,40877455,41148648,40929615,36883360,41172619,41141535,41211174,40970745,41064348,41220953,40970744,41304071,41085947,40929613,41189791,36883896,40908460,41095927,43638698,43782573,40867401,43674927,43818572,41108075,41235096,40922587,41085946,41220952,41064347,41251939,41002117,40877451,41314104,41095925,41314103,41158613,40929611,40898510,41117169,41117168,40836325,40867399,19109937,35153700,35156060,41204145,40861768,41050560,41019258,40727839,40727838,35150375,35137609,43134418,41019257,43167452,41113279,40727834,40727832,40727833,36811735,43034240,36811152,44081619,44044233,36226162,36226163,36226164,40953636,40891439,40953637,36226690,36226691,36226692,19068969,41076512,41296848,41116804,40867033,40960588,40938904,41281982,41188896,19068988,40828888,41170465,40984773,41116802,40898152,40938903,41126316,19068986,19068985,19068989,41078535,19110197,36225097,36225098,36225099,36225100,36244646,1181809,19085966,19032629,19080065,19031828,1181898,1181838,1181899,1181839,19098815,41015745,1181897,19118077,1181865,19031780,19117320,1181901,19080067,1181922,1181841,19099039,1181862,1181924,1181863,1181900,1181840,1181896,1181864,1181895,19080068,1181925,19080069,36226708,1356217,1356218,1356215,1356216,36226709,36226710,36240753,36240754,36230979,1511248,1154621,1511247,40163900,19131109,19131111,1511246,1154619,36230216,36230217,36226210,36226211,1125449,41263268,41177981,41115472,40934961,41122417,40952873,44117211,44168692,44165611,44105728,44096991,44085785,44088278,44183158,19101352,19115884,41140560,19101353,19115885,19099294,19115325,40859394,41294440,40959223,40841556,41109224,40175383,40175384,42903089,42902374,41205378,40956236,36220150,40152687,40152688,44121393,36220151,36220152,36220153,36248769,19028950,35159338,35158426,35141413,35144635,35140952,35150822,19111540,35139664,35150042,35149235,42941598,42941599,35142345,35140864,35157582,35149353,44109828,44071162,44060026,44111472,44049577,42941597,19090659,35130898,35157675,35137925,35152854,42941602,19090660,35150373,35132779,35133014,40921621,35157321,35143167,35129573,35141909,35144637,19111541,35152583,35150372,35150991,35152706,40983949,42941603,42941604,35146684,35150484,35160199,35130984,44029688,44043760,36223695,36223696,36223697,36238935,36238936,36238937,36238938,19035396,41076011,43765498,43621596,43676005,43621597,43711629,43657853,43603675,43603676,43801525,43801526,43621598,43765499,43693728,43747547,40826364,41232447,41140437,40865527,40834392,40934295,40903091,41201389,19111674,43693727,19099295,19115326,41077675,19099296,19115328,19111133,40826365,36214651,36214652,36214653,36214654,19063387,36240968,36240969,36240970,36240972,36240973,36240974,36240975,789792,789793,1236744,43279458,43263090,41044406,41171422,40950892,40921352,40982025,41046072,40834057,40871010,41089500,41083637,40950893,41077462,43138188,43160356,43182255,43171260,43193194,43215079,41169787,41140254,41114852,40958610,41089509,41183355,40919752,40921354,41083639,41026797,40902030,41020852,35412649,35410325,35409770,35412896,35407647,35406876,40857434,41140253,40927345,40865162,40995737,41214687,21095485,21026819,40725799,40726334,40726331,40726333,40726332,40725798,40725797,21026820,21036612,21144583,21154512,21066067,21026821,21056242,35143912,1356243,1356245,40163421,40163422,35133536,1236772,21066064,36509721,36812271,21154510,44176710,21066066,21154511,21095484,21134694,21144582,21164327,21174109,44184151,21144581,21026818,43034253,40989871,40933221,41089499,41195220,40871009,40839868,41101240,41195219,36505941,41301760,40958607,41052052,41120718,40933220,41132549,41276573,41038475,43034853,42620619,41177370,41301761,41020849,41183353,41152312,41276576,36813716,43149132,43204226,43160359,43171262,36811466,36889383,43584404,36893867,43710416,42620783,41114851,41020853,40958609,40839876,41152318,41120728,1236767,40983674,41108884,41202830,40983673,36808441,36812395,41171421,41140250,41295738,40983672,40827811,35145040,35151001,41013309,41077461,40834061,40839875,41183354,41120727,41052055,41177371,19112110,41108883,19083153,43171261,41138691,41140251,41052054,41177369,41245606,41120721,1236773,41014896,40983677,40859070,43710415,21164326,40890380,40983676,41202832,41202831,40859069,41046073,41077460,40921353,41233878,41295739,40952528,40983675,41140252,42481922,41299179,42478939,44160781,43138186,36219301,36813480,36811710,36812414,36813815,36219302,1356244,1356246,36219303,36219304,36219305,40163426,40167341,40163430,40163432,40163440,40163444,40163445,40163448,40163452,40163453,40163454,36219299,36219300,36227922,35198052,35130476,35143557,35156091,35132506,35153625,35151937,35149265,35133367,35131026,35141815,35161627,35137458,35154275,35152712,35147767,36243175,36243176,36243178,36243179,36243180,36239350,36239351,36239995,36239996)

) I
) C UNION ALL 
SELECT 3 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (43759505,43795491,43723536,43153708,43164725,43208530,43186627,43219535,35141811,35151703,43791769,43719875,43809929,35146592,35142501,21059867,21099174,21040247,35798380,40711761,40711760,35798356,35798367,36808751,36808765,35152324,35157608,21069806,44217407,44217413,21148220,21050035,44217347,21138368,21030427,43208924,43187048,43187049,43165128,43142964,41425048,41415608,41424053,41413864,41424218,41426565,41424217,41422509,43753786,43825905,43862131,43771804,43627892,41370347,41369097,41362370,41361317,41367868,41371085,41370188,41365023,41364305,41362368,41372150,41363108,41364874,41373215,41363109,41370187,41368792,41371859,41364304,41369577,41369576,41361316,41363831,41372874,41369862,41370186,41367134,41362367,41366385,41362366,41363421,41369096,41370623,41370185,41372873,41367563,41361584,41366384,41361919,41366037,41368634,41363830,41367562,41366036,41370184,41367133,41369861,41367867,41365282,41367561,41365281,41367132,41364172,41362365,41366383,41369095,41362364,41364555,41372149,41362856,41368791,41370346,41364302,41369575,36418583,36418582,36418581,41368287,41364554,41372148,41366828,41363107,41369860,41369094,36279382,36780030,36780029,36279913,36506576,36509331,43592103,41361582,41366035,41366034,41367559,41362082,43789876,41368013,41368633,41371697,41362081,43826102,41362855,43646225,43700250,41365277,41369858,41363105,41372869,41366827,41367560,41369859,41370622,41366381,41366380,41364872,41369437,41372872,41364873,41370924,41366033,41369092,43736138,41369091,41362363,43717983,41372871,41368286,41365279,41365625,41369436,41361581,41370923,43717986,43862365,43610052,43772056,43736137,43628121,43789877,43826103,43844181,43862366,43772057,43826104,43682232,41363106,41369093,41366382,41372870,41371698,43700251,41366032,43862367,41370621,43682233,43772058,41366826,43717984,43592104,43664350,43736091,43807938,43753960,43736092,43682188,43592054,43717939,43628067,43807937,43807936,43807935,43862308,43682187,43844133,41363663,41368460,41361766,41372516,41370032,41373292,41367724,41370264,41371009,41372306,41368904,41368114,41363662,41368902,41370785,41368456,41368710,41363492,41373055,41373291,41364402,41361764,41362540,41373293,41368711,41362200,41371980,41368459,41363273,41369509,41368718,41372515,41364949,41371788,41367206,41364247,41362769,41370462,41372713,41370033,41370786,41364947,41362766,41369506,41367201,41371007,41371786,41371006,41366470,41371785,41367945,41361765,41372307,41367198,41371784,41364946,41361991,41366469,41367200,41365698,41364945,41366468,41367199,41368715,41372712,41368115,41372711,41369275,41362767,41367202,43844132,43807934,43789827,43682186,43609979,43628066,43664349,43736090,43664348,41364403,41364025,41364024,41369274,41367941,41371005,41361990,41370261,41368714,41373298,41362765,41361989,41363493,41373297,41362764,41371004,41371003,41366991,41363271,41368712,41367944,41367943,41368713,41371002,41366467,41364243,41361988,41370260,41373296,41367942,41364242,41373057,41364241,41366466,41371783,41366465,41365697,41373295,41372514,41372513,41370262,41364245,41364244,41369693,41366672,41370461,41372710,41368903,41371879,41362096,41372893,41366853,41362710,41363572,41367579,41369449,43772079,43826117,43772080,43592123,43862382,43808006,43700266,43610068,43592122,43682249,43628139,43789900,43754030,43628138,43592121,41372574,41365010,41361571,41369076,41366371,41366536,41362062,41362061,41362350,41370609,41365269,41367859,41365612,40711714,40711713,40711712,36808999,36808996,36809000,40711717,40711716,40711715,36808998,36808997,36808995,43634439,43850344,43670552,43832332,43724213,43688394,43742363,43814242,43778248,43634441,43832333,41522335,41522499,40711973,40711972,40711971,36809024,36809030,36809031,41522280,41522285,40711976,40711975,40711974,36809021,36809029,36809035,35160891,35161128,41479518,41479501,41479527,41479512,41479487,41479525,41479606,41479514,41479513,41479572,41479531,41479635,41479664,41479641,41479656,41479647,41479675,41479674,41479630,41479666,41479653,41479668,41479721,41479683,41479692,41479689,41479684,41479685,41479712,41479680,41479720,41479694,41479693,41451310,41451299,41451295,41451301,41451306,41451297,41451294,41451309,41451312,41451308,41451304,41451296,41374400,41374467,41373824,41375916,41373768,41374084,41373607,41374374,41375003,41374466,41375688,41374211,41375097,41374373,41374293,41374465,41376051,41373896,41373823,41375985,41373895,41375857,41374793,41375772,41373656,41375096,41375353,41373583,41375541,41373655,41375494,41375493,41375206,41374048,41374863,41374083,41373894,41375037,41375915,41375639,41374150,41373928,41375402,41374468,41374375,41375689,41375773,41374241,41374754,41374753,41375321,41375320,41374638,41375004,41374712,41373658,41373657,41375319,41375543,41374152,41373739,41374294,41375470,43808275,41375205,43682521,43754314,43700563,43844451,43664670,43664671,43862661,43754313,43736411,41375669,41373962,41375843,41373713,41376034,41374739,41376033,41375377,41374961,41375728,41375830,41375062,41374962,36418538,41374816,41375429,41375132,44193370,41374883,41374723,41375790,41374220,41375789,41375332,41375331,41375788,41374882,36418539,41374771,41373951,41374595,41374516,41375729,41375623,41375792,41373911,41374384,41373756,41374383,41374015,41375926,41375622,41373910,41375791,41375333,41375019,41373585,41374221,41375334,41374111,41373623,41375061,41375892,41376018,41375621,41374515,41375279,41375659,41375224,43790198,43826428,43718298,43718299,43664717,43646588,43826429,43610357,43844492,43610358,43682571,43790199,35155561,35151981,43590077,43698215,43644270,43842131,43715979,43662338,43734089,43608045,43787880,43860342,43824060,43770006,35148191,35159226,35137202,35153211,41486867,41486112,41486762,41486800,41484523,41485904,41485799,41486395,41486003,41485265,41485474,41487222,41485689,41484440,41486447,41486866,43043769,43043770,43043771,35798573,35798582,35798556,35798586,35798591,35798508,35798490,35798581,35798504,35798494,35798553,35798562,35798595,35798543,35798527,35798563,36809374,36809351,36809367,36809361,36809368,36809347,36809354,36809340,36809375,36809358,36809371,43043760,43043761,43043764,43043763,43043762,40710862,40710852,40710851,40710854,40710853,40710859,40710855,40710861,40710857,40710858,40710860,40710863,40710856,43043765,43043768,43043767,43043766,46234464,41522644,44217932,44218045,44218092,21089279,21030457,43043757,41522766,44217824,44218093,44217853,21030462,21118753,46234508,44218079,44218139,44218097,44217981,44217992,44218027,44218046,44217934,21040281,21158229,44217926,44218095,44218128,44217991,41522707,44218091,41522643,41522659,41522676,44218096,41522672,44217892,41522600,41522712,41522607,41522650,41522623,44218044,41522799,41522637,44218129,44218138,36897501,21079589,21069839,44217980,44217893,21030459,21138399,43281723,41522612,21138398,21069836,21148256,21148257,43270845,21050066,21109018,21177705,21158227,21168002,21059901,21079588,21050067,21118750,43265357,41522693,41522744,41522651,44217933,44218094,21118751,21099204,21138400,21069838,21118752,21050069,1154615,42918919,42918918,41522790,41522781,41522679,41522717,41522731,41522792,41522746,41522638,41522608,41522669,41522689,44217884,41522780,41522779,41522725,44218047,44217894,41522683,41522682,41522614,41522745,41522678,41522668,41522695,41522754,41522677,41522763,41522646,41522704,41522694,44217847,44217993,41522658,41522601,36778148,36778146,36778145,36778144,36778147,36778143,36778142,36778141,35798572,35798554,35798596,35798491,43522491,40710896,36778152,36778151,35798564,36778153,35798568,35798532,35798598,35798531,35798584,35798520,35798530,35798528,35798529,35798565,40710906,40710905,40710904,40710903,35798555,35798509,36283941,36778150,36778149,36283940,40710902,40710901,40710900,40710897,40710898,40710899,43522493,36283935,36283936,36809370,36809357,36809344,36809376,36809377,36809350,36809335,36809348,36809360,36809338,36809355,36809356,36809333,36809342,36809378,785043,36809365,36809346,36809334,36809372,36809352,785044,785046,43043759,785047,785048,785045,43043758,785049,785050,40710879,40710878,40710890,40710872,40710871,40710889,40710892,40710895,40710893,40710891,40710894,40710888,40710887,40710886,40710885,40710884,40710883,40710882,40710881,40710880,40710877,40710876,40710873,40710874,40710875,44217809,44218048,44217885,44217855,44218073,44217816,44217854,21128526,44218099,21099203,21168001,44217815,44217935,44217814,44218098,35798607,40710870,40710869,35798574,35798546,36809369,36809337,44217882,44217984,44217861,44217948,44217945,44218106,44218004,44218054,44217859,44218148,44218147,44218002,44217896,44217817,44217947,44217862,44217946,44217925,44217983,44217830,44217860,44217899,44218149,44217898,44218105,44217897,44218003,44218053,44217829,40710445,40710444,40710443,44217843,44218130,44218141,42918920,42918921,35143454,35162067,21050079,44217846,44218090,21138407,21168006,21069844,21128531,21030465,44217883,44217891,21138406,21177715,41487697,41487690,41487698,41487696,41487689,41487688,41487691,41487693,41487695,41487694,41487692,41487699,44208024,44208030,44208026,44207995,44208002,44208033,41377041,41380415,41377915,41379792,42920247,42920248,21117568,41376666,41379793,41379040,41380778,41379569,21147035,21068599,36809427,36809431,36809411,36895797,43844770,43700885,43754627,43682834,43754626,41380918,41380677,41381452,41377004,41377003,41382067,41378195,41378763,41379859,41381095,41381202,41379596,41380245,41377005,41381863,41376629,41378963,41382068,41379342,41376721,43610616,43844747,43808585,43718563,43772634,43754611,43718562,43844746,43790434,41381321,41376532,41379860,41379597,44193635,41381320,41381253,41380417,41376445,41380600,41377361,41378891,41377033,41381390,41377196,41380345,41378890,41377409,41378487,41381389,41378645,41378644,41379213,41380772,36809432,41378122,41380011,41376432,41380164,41465253,41465218,41465261,41465260,41465257,41465245,41465230,41465254,41465222,41465248,41465229,41465258,41465270,41465231,41465238,41465243,41465242,41465251,41465227,41465233,41465263,41465226,41465234,41465220,41465241,41465221,41465269,41465256,41465239,41465265,41465235,41465237,41465240,41465223,41465268,41465228,41465259,41465247,41465252,43634627,43760376,43832566,43670753,43688606,43616452,43670754,43868751,43616451,43796365,43850560,43688610,43814434,43688609,43778465,41465298,41465286,41465279,41465295,41465323,41465297,41465317,41465302,41465285,41465284,41465289,41465280,41465283,41465322,41465299,41465313,41465282,41465293,41465291,41465304,41465278,41465307,41465315,41465275,41465296,41465281,41465309,41465314,41465312,41465276,41465320,41465290,41465277,41465294,41465274,41465308,41465310,41465301,41465303,43868752,43742575,43832567,43670755,43598490,43814433,43652700,43706520,43598491,43688607,43778464,43760374,43796364,43868754,43760375,43652701,43616454,43724433,41465336,41465327,41465339,41465352,41465354,41465353,41465328,41465340,41465329,41465341,41465349,41465344,41465342,41465335,41465355,41465345,41465324,41465350,41465326,41465351,41465330,41465347,41465343,41465325,41465337,41465346,41465332,41465348,41465334,41465331,41465338,41465333,41465372,41465385,41465367,41465363,41465366,41465359,41465387,41465368,41465361,41465369,41465362,41465357,41465371,41465380,41465360,41465384,41465373,41465379,41465374,41465377,41465365,41465386,41465358,41465376,41465370,41465364,41465383,41465382,41465375,41465378,41465381,41465356,41487832,41487827,36417210,41487833,36417211,41487830,41487831,41487829,41487822,41487823,41487836,43613891,43668191,43631999,43793758,43650158,43775806,43811882,43775807,43829905,43739934,43632000,43757836,43775808,41465411,41465394,41465404,41465417,41465410,41465415,41465423,41465398,41465406,41465399,41465413,41465420,41465400,41465409,41465425,41465407,41465424,41465421,41465402,41465401,41465403,41465412,41465418,41465422,41465419,41465395,41465416,41465397,41465396,41465408,41465414,41465405,41488770,41488182,41489206,41488749,41489689,43866319,43757952,43596054,43793866,43793867,43668300,43812023,43668301,43632138,43686208,43848065,36897274,36897275,43742590,43634637,43760392,43832591,43754803,43665131,43772806,43647017,43610781,43610782,43187384,43220220,43220221,43154430,43187385,44135482,36896563,41431325,41431863,43632157,41431477,41431129,36896569,43812040,41431195,41431780,41431656,41431615,41431795,41431038,41431524,43757970,43596077,43596078,43848090,41431431,43775958,43866335,41431926,43830046,43614008,43830047,41431095,41431056,43757969,41431925,41431037,43632158,43668323,41431036,43740075,43668325,41431924,43757971,43866336,41431094,43740073,43775956,41431560,43848089,43793887,41431670,43721944,43668324,41431861,43686232,43704170,41431669,43740074,41431559,41431862,43830048,44198962,44198923,44198982,44199006,44198930,36896567,43830039,43830040,43614002,43632149,43848084,43704167,36896566,43668317,43812034,43757963,36896557,43775949,36896574,43614001,43686227,43793880,43650279,43668319,43596073,43596074,43686228,43812035,43650278,43848085,43721940,43668318,43775950,43632150,43632151,43830041,43668320,43830042,43721941,43848086,43668321,43632152,43614003,43704168,43721942,43757965,43614004,43614005,43775953,43632156,43812037,43848087,43757964,43775951,43632153,43775952,43596075,43686229,43812036,43848088,43793881,43632154,43632155,43830043,43793882,43793884,43757966,43793885,43740072,43686230,43614006,43830044,43830045,43812038,43668322,43812039,43793883,43704169,43757967,43775954,41431494,41431215,43757968,21138024,44135478,44135475,43259649,43292288,21147888,21069475,21098837,21079225,40717377,21118403,21069474,21098836,21128170,21118402,21030096,40717378,21030097,21059515,43292286,43276106,43265066,43286913,43297695,43292287,43259648,43259647,21049732,43187380,43281452,43259651,21157864,21069473,21059514,43292285,35788173,43297694,21088944,21138025,21088943,43292284,21157863,21147887,21108661,43270556,40717379,21039936,43259646,43270557,21108662,21039938,21088945,21167639,21167638,21108663,21059517,21039937,21059516,43176434,43198398,43143276,43154429,43187381,43209229,43286914,43281454,43265067,43281453,43297696,43292289,43259650,43276107,43198399,43209230,43165393,43281455,43292290,21069476,21177380,21167637,21079226,43259652,21118405,21128171,43187382,43187383,21118404,21147889,42921728,40717376,40717371,40717369,40717370,40717373,40717372,40717374,40717375,36809522,36809528,36809503,36809477,36809507,36809520,36809526,36809518,36809523,36809529,36809521,36809500,43039759,43039756,43039757,36809494,36809508,36809499,36809501,36809502,36809530,36809525,36809495,36809505,36809516,36809509,36809496,36809515,36809497,36809512,43039760,43039761,36809511,36809519,36809504,36809531,36809524,36809498,36896558,43866337,36896559,43668326,43632159,36896565,43793889,36896573,43775959,43596080,43866338,43686233,43668327,43596081,43757972,43740076,43632161,43721945,43793890,43830049,43632160,43775960,43793891,43596079,21157865,43286911,43286912,21147890,21069478,21079228,21108667,40717388,21157867,21118407,21108665,21069477,21108666,21128173,40717389,21088947,21059518,43270554,43281449,43286910,43276105,43259643,43297689,43292282,43276104,21177382,43143277,43292283,43297692,21088946,21049733,21128172,43259642,35788181,43281448,21118406,21098839,21098838,43265062,21030098,21157866,21108664,43270553,40717390,21177381,43259641,43259640,21079227,21039940,21167640,21039941,21177383,21098840,21059519,21069479,21030099,43220222,43198400,43198401,43176435,43143278,43198402,43281451,43259645,43265064,43297693,43297690,43259644,43265063,43297691,43143279,43198403,43154431,43270555,43265065,21098841,21039939,21088948,21147891,43281450,21059520,21118408,43154432,43165394,21079230,21079229,40717387,40717382,40717380,40717381,40717384,40717383,40717385,40717386,43039764,43039762,43039763,36809517,35139065,35134667,43812100,43686296,43704222,43866376,43812101,43614058,43632212,43614059,36809635,43039519,43039518,43039523,43039521,43039520,43039522,36809586,36809624,36809573,36809559,36809569,36809571,36809591,36809582,41490606,41492421,41492979,41490071,41491430,41491877,41492672,41491570,41491623,41522857,44218214,44218191,44218203,44218213,44218231,41522844,44218233,44218232,44218242,44218230,44218253,41522854,41522836,41522843,44218202,44218260,44218252,44218200,44218229,44218241,44218228,41522835,41522851,41522852,41522842,41522853,41522858,41522839,44218269,41522847,41522848,44218268,44218251,44218217,44218250,41522856,44218212,44218216,41522840,41522841,41522850,41522834,44218227,40173416,40173417,43845031,43610902,43592959,43701162,43718879,43718880,43790729,43808888,43629060,43647139,43592958,43259205,43264618,43275673,43291837,41385273,41389403,41386262,41389181,41388688,41384894,41388550,41387975,44194766,41389182,41388070,41389485,41388631,41388069,41385567,41388428,41385401,41387135,41386093,41385210,41386092,41386145,43758535,43650851,43686775,43670896,43850694,43652827,43778609,43868893,43652828,43796510,43742706,43724601,43724602,43830648,43830649,43722552,43776585,43650861,43740686,41490023,41490031,41490028,44218294,44218296,44218295,40173433,40173434,40709703,40709700,40709697,40709699,40709698,40709702,40709701,21099209,21099210,21059910,21089287,21030468,21040287,21089286,40713725,40713724,40713723,36809784,36809780,36809782,40713728,40713727,40713726,36809781,36809785,36809783,35419351,35419350,35419352,35419348,35419349,35414213,35414216,35414217,35414214,35414215,41398119,41400210,41396684,41400211,41395477,35158229,35131132,21089242,21128483,21040240,21158185,21148215,21089243,21040238,21040239,21108985,35798224,35798280,35798322,35798234,35798273,35798235,35798287,40713427,35798286,35798248,36810189,36810199,36810193,36810186,36810191,36810182,36810190,36810185,36810188,43867640,43723279,43669579,43777322,43597374,43741413,43831353,43687501,43741412,43651600,43633521,43615349,43777319,43615350,43867642,43777320,43831352,43651602,43723276,43687499,43651603,43597372,43741411,43669577,43813365,43705421,43867643,43597373,43615351,43705422,43723277,43687500,43777317,43651601,43759242,43867641,43687498,43759241,43777318,43705420,43741450,43651639,43687537,43597411,43723317,43669617,43755797,43737842,43719715,1154617,40163919,40173455,40173456,43597541,43795417,43867821,43831545,43651774,43651775,43687686,43777522,43795419,43615524,43615525,43723475,43867822,43795418,43597542,43777520,43813546,43669782,43633725,43615523,43777521,43669780,43651772,43597540,43705596,43651773,43615522,43777519,43633724,43795416,43849634,43705597,43687685,43777517,43669781,43777518,43759440,43813545,43687684,35137405,35150965,43724716,43778761,43652969,43869027,43832846,36221811,36236443,1154343,43729027,43764910,43585027,43855148,43764911,43837210,43837211,43729028,43675404,43800919,43800921,40890530,36881999,41308356,40871694,43746966,43855154,41270993,43657267,43855156,43764913,43855155,43693125,43657266,43657265,43621030,43729031,43603063,43746965,43639189,42718772,42716339,42724587,42725032,42719691,42727298,36891151,43783072,36882000,43764903,43675401,43675400,43800915,40859217,43603059,40996446,40840586,41183986,41271003,43855144,40927619,43819049,41302085,43837207,40996429,40840559,43819050,43800916,43639184,43621023,43621024,43764901,43764902,41264823,43675399,43855143,43783073,43693117,43746959,43621025,43783075,43764907,43729024,43746962,43783078,43764905,43657259,43603060,43783076,43693118,43783077,43819051,43746960,43657261,43855145,43746961,43819052,43621026,43639185,43675402,43603061,43657260,43657258,43783074,43800920,36882904,43621028,36885826,43621029,43855150,43711034,43585029,42725432,42721973,42728611,42715192,42713008,42723712,42729048,42710388,42715645,42726393,42730961,42719013,36884337,43584114,36885825,43763993,43692223,43692224,43763994,43799999,43855157,43657268,43675407,43657269,43819054,43675408,43639190,43675409,43711037,43746967,43621031,43585030,43764909,43693120,43657264,43729029,43800917,43585028,43639188,43729030,43693122,43855149,41044572,41021137,41177655,41177654,40958906,41271002,40865427,40965133,41121444,41090200,40871715,41058641,40965132,41246328,41115164,40990152,41277210,41090225,41140394,41077617,41075959,41302090,41146729,41152960,41308363,41109045,42730726,42717946,42717945,42726395,42715646,42710999,42729440,42724586,42719266,42713007,42719690,42729911,42721972,42718400,42725030,42712368,41075958,40865437,41021129,41058620,41121425,40927624,41177647,40902729,41246313,41203006,41169935,41177640,41209176,40840553,40933908,40890525,41013466,40958902,41240134,40896626,41270992,41152951,41183980,40840563,40824590,41146725,40927618,41277182,41215304,40827962,41109040,41169936,41052324,41146727,40871685,41058611,41140385,44065570,44109782,44059881,44126985,44105534,43855138,43800904,41052334,41302096,41308373,41277206,40871706,43764897,40890539,43800903,40888910,40983807,40865445,41308376,40996445,41215331,41090224,41052336,41209185,41302099,44104273,44058226,40896633,44072709,44101006,44027879,44026544,44083987,44111349,44049386,44053907,36890189,43729025,43729026,43621027,43693119,43837208,43585025,43639186,43657255,36893701,43783071,43621019,43800905,35157926,43783068,43783067,43657252,43800906,43657253,43800907,43783069,43783070,43603052,35153732,43746954,43746953,40888909,41234024,41146728,41277191,41121426,41177648,41302089,40865438,40902730,41183991,40965119,41215311,40871698,41090212,41246315,41058621,41246314,41215310,40965118,40952680,41295895,41046221,40859211,40859210,42722763,42731199,42725033,42712369,36886266,43657263,43675403,41115166,40871721,41295900,43855147,42722762,42720613,42725031,42724344,43692222,36883893,43638253,42711256,42710387,42713629,40919909,41115153,40927615,40902720,41183977,40921497,43837204,41052327,41121418,43800913,43837205,43675396,40927623,41027451,40827966,43819047,43603056,41234023,43855146,43746963,43764908,43657262,43746964,43585026,43639187,43800918,43693121,43837209,19108688,41203010,43729021,43819048,43639183,43729022,43675397,43711032,43657256,43746957,43746958,43693116,43675398,41209187,40996453,41308382,41209186,41021139,40958907,43603057,43800914,43800908,43675393,43764899,43800909,41271005,43855139,43764898,43585021,43585022,43693112,43675392,41201352,41264825,1154497,40896627,41240135,19117781,19115871,36814076,36812649,43036316,43036317,35767040,36404828,35750395,35769395,35750394,36406343,35754632,35752686,35754631,35769382,35758743,36404049,36407887,36406341,36404829,36407888,36812437,36814053,43036314,43036315,589320,40723760,40723759,40723762,40723761,40723767,40723763,40723305,40723765,40723766,40723768,40723306,40723764,44111348,590456,44087996,44092613,43036313,43172437,1154459,44175651,43268394,21091535,44066924,41234021,36880735,21022904,43257509,44186905,46234465,41152954,21052335,21072078,40825771,21081770,21120944,46234509,44169300,44165489,44188012,21052345,21032660,40933913,44180490,41058614,41246308,41308354,41027449,41246307,44180492,21052341,43279281,36881998,44176808,21052344,21160452,44188011,21140663,21130711,43295524,44176807,40865429,40865428,21022905,21022906,21160450,21140662,43268395,21160451,21150503,21062170,21111261,21062169,21111262,21062171,21120942,21072085,43279285,40871692,40902727,44180491,41152956,41058616,44173036,44184224,44165488,41090205,41152955,40902726,41058615,40933912,41215308,44188010,44188009,21062173,21052343,21170240,21140664,21150504,21042575,42903088,44072708,44062395,44111357,44101010,42902448,42903179,44072713,44085591,44049395,42902903,44118522,46234506,19044359,44118521,44027884,40890529,44175650,44168195,21120941,44168194,40890528,44183150,44179435,44160601,41109038,41295894,40983799,41015036,44186904,40859208,44186903,19131110,43161456,43194368,43183355,43216221,43205323,43139334,42931130,42931129,41138837,40865433,40996433,40871696,41270994,41277189,40840565,44173038,40965112,41277188,41090209,41277187,40996432,40902728,41121419,41183988,41246312,40965111,44173037,41052328,41121422,40921504,41171570,41052335,41184006,40996443,41101643,40840581,40933931,40840580,41152975,41115162,41240138,41115161,40840585,41058640,41101645,40902744,40871714,41215330,41215329,41215328,41277209,40840584,41101644,41027462,41058639,40990151,40896635,40896634,41184007,41215327,40840582,41308375,40851975,41277208,40902745,41308374,40896636,41271001,40840583,40933932,41264832,40983806,41077616,41203009,41140393,1154533,1356174,1154496,36812499,36814532,43516247,36782804,36782802,36782801,36782803,36782800,36782799,35771371,36407152,35771370,43516049,40723358,36782806,36409430,36782807,36406347,35748545,40723369,36405579,35769386,35746252,35769385,36404050,36404830,36406342,40723368,40723367,40723366,40723365,35758744,36405578,36275318,36782805,40723364,40723363,40723362,40723359,40723360,40723361,43516871,36270209,36813940,783971,783973,783974,783972,783975,40723341,40723340,40723352,40723334,40723333,40723351,40723354,40723357,40723355,40723353,40723356,40723350,40723349,40723348,40723347,40723346,40723345,40723344,40723343,40723342,40723339,40723338,40723335,40723336,40723337,36808844,36811622,36812757,36261553,36271766,36811920,43161464,41152964,41277197,43205332,40990149,40945519,40976481,41146730,43194378,40945520,40927626,41101639,40927625,40871700,41215315,41121430,40914159,41257553,41101641,41183993,40914160,41152965,41007827,40871699,40840572,41257552,41277199,41058623,41226704,40965122,41027453,40933920,41152962,41215313,41277195,41152961,40851971,40851970,41101638,41101637,41277194,41277193,40883238,41132969,40883237,41195640,41164319,41038890,41101635,41038892,40851969,41101636,40824393,40840570,41070188,41038891,40840569,41288599,43183362,43172449,43150282,43172450,43205333,1154453,44096904,44059880,44049384,40865440,41240137,41320009,40851973,40834321,40990148,41101640,44111346,44049383,40933922,40933921,40902732,40851972,41320008,40914158,41257550,41090214,41257551,41164320,44085587,44036265,44124545,44087989,19101999,41240131,40958900,41015035,1154541,19120958,1154536,19098332,40826318,41263154,44176095,44176810,41115163,44184226,41246329,44183151,41234027,41021126,41021125,41027439,41277180,41257546,41007826,41083928,41270988,41302082,40965103,41308349,41183978,41308348,41109036,40921498,41264822,40951060,41052322,41302081,40871681,41121413,40921496,41234017,1356110,36814286,42479850,21081768,21042568,21042566,21042567,44184225,44169301,42479248,21170237,21140658,21081767,21120938,21140657,21111259,21170236,40723319,40723318,35771372,35765169,40723315,40723314,35754634,35769390,40723317,35752691,35748547,35744337,35756901,35744339,40723316,35744338,35769389,36810848,36814745,36811042,36814057,36811224,21150488,41271000,21062156,41240133,21062157,21101418,21101419,40896625,41257549,40865430,21101417,40927620,41177641,41132968,21032656,41152957,40871693,41288598,41027450,40851968,41184005,41215326,41288604,41152974,41058638,40965107,40933914,41277186,41308355,21032657,21062159,21052333,21120933,21052334,21022896,21091528,21062158,21022895,21160443,21081763,21170232,21111256,21140656,21052332,19072359,40164006,44032256,35754087,35754085,35770836,35761056,35745707,35761057,35754637,35775534,35752695,35746253,35752694,35771373,35756904,35761054,44059882,35750396,35744341,35754639,35748549,35769399,44049387,19086690,1356112,40982202,41177646,41177645,40896629,40990147,40865436,19099825,19120957,1154535,19098331,40919910,40982203,40865439,41308365,41109046,40927616,41270989,40902721,41246303,40890526,1356116,36810759,40723330,36811280,36810435,36813731,21042577,40865431,21160453,40834320,21140665,21111264,21081772,41302092,41257554,40834319,21091536,41209178,41115154,41288594,21042578,41308368,41090217,41164321,41058608,41257547,41246310,40871695,41277183,41090197,40823966,40965105,21150506,21081774,21091538,21052346,21160454,21170241,21111265,21062175,21150505,21140666,21081773,21091537,21022907,21062174,21130713,19004125,44071120,35766521,35766520,35775083,35744333,35770834,35756895,35754630,35754629,35773761,35750392,35748538,35750393,35761051,35769381,44124547,35746251,35765164,35771369,35748539,35744332,44049393,19085818,19116924,44079614,44092614,19044360,21140660,19115323,35151522,19054320,42724123,42721974,42715193,42721087,42726394,42728326,19086687,44118519,41046230,36880076,44098518,44126989,41058644,41277213,41090227,41308378,41052337,40865446,40896637,41021138,43172442,41083938,40834322,40933933,40996448,41277212,41121445,41027463,44098517,44062401,44046875,44062400,44085588,44101008,41215335,41184010,41215334,41215333,41277211,41308377,40902747,41090226,41058643,41246330,41184009,41058642,40871718,40902746,40871717,40871716,40996447,41215332,43150279,43205327,41109050,44040857,44066927,44118518,40859219,40952682,40859218,43161460,41015042,41015041,43139337,40983808,19117782,41046229,19115872,36886265,41140391,36884824,40902737,40825834,43711030,41021132,41209181,36882001,43675394,40927627,41302091,41270997,41277203,40996439,41090216,43603054,43746956,40871702,43837203,41277202,43855140,40933923,41246319,41277201,41121431,43819045,41058625,40902735,43729020,41215318,40902734,43621018,40871701,43639182,40965124,41277200,41246318,40827968,43800910,41109047,40983802,43837202,41203007,40890538,40983801,40921503,40890537,41075957,44172391,44179871,44176806,44165487,40859206,19103065,1154501,19053005,19120386,19123989,1154373,1154374,19123990,40164014,19044358,40164015,36887206,43837196,36883894,43729012,43675388,43837198,43585018,43783065,43746948,36882902,43800901,43855135,43693107,36893700,43819038,36887750,43764893,43675389,43657249,43693108,43729014,43675390,43783066,43729013,43764894,43855136,43729015,43729016,43746949,43693109,43585020,43837200,43675391,43729017,43764895,43585019,43800902,43603051,43837199,43819039,43746950,43746951,43746952,43764896,43657250,43639178,43855137,41058618,41246309,43729011,41171569,43675387,40827965,43693106,41234022,35146942,35155935,35132343,35139460,19096013,19108686,19093833,44066929,44079613,43290098,41046218,44040856,43273911,44027880,44072714,44062403,44098516,43268402,43273912,44059884,44036268,21101415,43279287,21052330,43205324,43295529,43273913,44062398,44087993,44098515,44101007,21130706,21170230,44072711,44062397,44098514,44036267,44098513,44049392,44124546,44049391,44111352,44049390,21140654,21081762,43172439,43183357,43194370,43183358,43273914,43279289,43279288,43290100,43216222,43139335,43290101,43257513,21072076,43262897,21052331,43205325,42931131,40723312,40723313,36812024,43036320,36814673,21120932,44053911,44040855,44025322,44053910,44066925,21081761,41295893,19115322,43183356,43150276,43194369,43172438,43290099,43284695,43161457,19117783,41203003,43279286,19115873,36811387,43172441,41171568,41138836,41015034,41021127,40996427,40871683,41101634,40976478,40851967,41183983,41288596,41226703,40914157,41183982,41101633,41132967,40914156,41146726,41164318,41115155,40958899,41152952,40902723,40851966,41027444,40976477,40824903,40883236,41215305,41183981,41195638,41101632,40996426,41288595,41195637,40840556,41090199,41038889,41246305,40914155,41090198,41257548,40933906,41277179,40851964,41215303,41164317,40996425,41027442,40883235,41058609,41226702,40840555,40851965,40871682,41027441,41027440,41302084,41302083,40871684,41027445,41288597,40827963,41203004,40983798,41234019,41203002,41109037,41234018,36884336,36882901,43819053,36888752,43711035,43603062,36882900,43855151,36885824,40965108,43675405,43855152,43675406,43693124,43855153,43837212,43764912,43711036,41046220,43693123,1154460,44118517,19117777,19117776,1154572,44027878,40859214,43279282,41140390,43262893,44111347,44049385,41246317,41152966,43262895,43268396,40902733,41146731,41052330,21081769,43257511,41177649,21062165,43183360,43268398,43268399,44062393,21120940,21052339,44098511,44126984,44046871,44126983,44072707,44087991,44046870,44087990,21072084,21150501,40840573,43205328,43172445,41090215,41027456,43216223,43194376,43290094,43268400,43295526,43268397,43205329,43194377,41058624,41183994,41215316,43290095,43284693,21062166,21101426,43257512,21042570,43139339,40723331,40723332,19060972,36810836,21120939,44027877,44079612,44066923,44040854,35159500,21091533,41046224,43183359,41015039,41015038,43161462,43262894,43295525,43194375,41140389,43257510,21091534,36814166,44053909,44118516,19044391,44118515,40952679,19115320,43205330,42931128,19117775,41264827,35159748,19054317,40857603,41294332,44160600,41270991,44188008,41270990,41058607,41058606,40952677,40927629,40927628,41115157,41115158,40840575,41308369,41164322,41058628,41121432,40851974,41090218,41058627,41007828,40902738,41195641,41277204,40840574,41183995,41215319,41264829,41046227,41109048,40859215,42931121,42931122,42931123,42931124,19108687,44118520,44066928,21170238,44085590,44075130,44033852,44101009,41115156,41021130,40896630,36419560,44124548,44049394,44111356,44075129,40933919,41215312,36419559,36419558,43855142,43290097,43284694,41308364,40965121,41246316,41027452,44111355,44062402,40902731,41277192,40965120,21150500,36782812,21042569,44079615,44027883,44027882,40921501,36419561,43819046,43290096,40890536,44053912,40952681,21140659,1154458,44079611,19117780,19117779,41046228,44066921,44053905,19044392,44079610,41264831,19115321,42931120,42931119,19117778,40890540,40983804,19054318,40827969,19023013,19035039,1356125,1356126,1154380,19130040,1154656,35131371,1154655,36813544,1356127,35138141,1356128,36894124,40890527,36892712,41308353,41058612,41277185,40871690,41302088,43855158,41302087,43819055,41209179,43639191,41302086,43711038,36881044,43603064,41246306,41090203,41308351,40933910,41090202,40824280,41058613,41215307,40902725,41090201,40871689,43585031,40996431,40996430,41121415,40871688,41183985,41308350,43800922,43657271,43855159,43675410,43639192,43675411,40902724,40840560,40933911,43729032,40871687,43693127,41277184,43819056,40871686,43639193,40952678,41077614,40921500,43621032,41264824,43837213,43783080,41234020,43693126,1154499,40859216,41109049,41264830,41203008,42931126,41140392,41295898,19115870,40983803,19023012,19120951,36894125,43764900,36214218,36214219,46234463,40987340,36782815,40987339,21101413,36887600,41112320,43657248,21101414,41237311,46234507,21022894,41206450,41268317,41237314,40862672,21072075,40893849,41206448,44179628,41018326,41018325,40831435,40831434,41018330,41299316,43205321,42480990,42480426,36214222,36215321,36215522,1356111,36814137,36811043,36813190,36813195,36814529,36813268,36813891,36811307,36811372,36813045,36814698,783970,36810717,1356113,36812524,36812404,1356108,1356109,1356117,35137878,43036312,1356118,36811728,1356119,36810970,35156586,35148127,1356122,36811825,36215523,36215322,36215519,36215520,36215521,40142703,40723381,44056680,40723378,40723379,44121273,40723380,44095369,44082376,46234512,40142705,44043683,44108217,40723384,40723383,41018328,40723382,44095368,35757988,40151684,42931133,44108215,36215524,36215525,36215526,36215527,36234409,36234172,36234173,1138050,1138095,19074278,1138051,19063706,1138096,19074277,19048151,19063707,36224016,1356138,1356139,1356136,1356137,36229426,36229428,36229429,36231359,36231360,36231361,36213198,36213199,36213200,36222849,36222850,36222851,36222875,36222876,40798689,41139755,40954417,41170910,41055588,41212309,40899710,41098388,41098387,41223356,41266566,40920866,41297577,40986621,40926342,36237526,36237527,36219436,36219499,36237787,36237788,36237789,19053979,41263826,40953805,41023103,41189796,36419986,41189795,36419987,41085953,43638700,43584560,43764443,43710587,43746511,43602575,43692649,43764445,43800449,43764444,43602574,43800448,43710588,35158217,35132159,41294931,40953804,41054365,41158611,40846322,41242071,40858281,40922588,41272966,40908459,41158614,41272965,41263825,40827007,41204144,41242076,41158615,41033187,41282814,41054368,40867402,41170608,41139467,40984977,40984976,40960954,41127155,36419984,41064351,41189792,41282815,36419985,40836326,41242077,41014146,41172620,41016085,41242080,41282819,41095928,41282809,41220957,41282808,40898511,40898508,41148649,41023100,40877450,41220949,41127154,41023101,41158612,41220950,41314102,41148645,41054366,43710586,41172618,41110173,40951679,41141536,41211176,41189794,41314108,40992192,43200457,36812489,43836753,40829099,41148646,41189790,40970740,40846323,40846324,40939701,40836323,40960952,41242073,41179733,43800443,43200456,36811587,44168884,44188714,44188713,44058727,44034663,44115119,19054032,44053131,36810411,40727837,40727836,40727835,40891612,40929614,41282817,40939705,41136198,41033189,40846325,41229878,41260652,41242078,40960956,41304072,44123394,44034664,44050682,36810313,19091094,43782575,41110174,36882004,43602573,43800444,43692648,43620587,43638699,35157112,43800445,40858282,41078772,41085951,41189793,40846326,40992191,44175609,19054010,44028625,42937994,35133541,35132330,40858283,41047381,41211175,40908462,40877456,40877455,41148648,40929615,36883360,41172619,41141535,41211174,40970745,41064348,41220953,40970744,41304071,41085947,40929613,41189791,36883896,40908460,41095927,43638698,43782573,40867401,43674927,43818572,41108075,41235096,40922587,41085946,41220952,41064347,41251939,41002117,40877451,41314104,41095925,41314103,41158613,40929611,40898510,41117169,41117168,40836325,40867399,19109937,35153700,35156060,41204145,40861768,41050560,41019258,40727839,40727838,35150375,35137609,44081619,44044233,36226162,36226163,36226164,36226690,36226691,36226692,19068969,41076512,41296848,41116804,40867033,40960588,40938904,41281982,41188896,19068988,40828888,41170465,40984773,41116802,40898152,40938903,41126316,19068986,19068985,19068989,41078535,19110197,36225097,36225098,36225099,36225100,36244646,1181809,19085966,19032629,19080065,19031828,1181898,1181838,1181899,1181839,19098815,41015745,1181897,19118077,1181865,19031780,19117320,1181901,19080067,1181922,1181841,19099039,1181862,1181924,1181863,1181900,1181840,1181896,1181864,1181895,19080068,1181925,19080069,36226708,1356217,1356218,1356215,1356216,36226709,36226710,36240753,36240754,36230979,1511248,1154621,1511247,40163900,19131109,19131111,1511246,1154619,36230216,36230217,36226210,36226211,1125449,41263268,41177981,41115472,40934961,41122417,40952873,44117211,44168692,44165611,44105728,44096991,44085785,44088278,44183158,19101352,19115884,41140560,19101353,19115885,19099294,19115325,40859394,41294440,40959223,40841556,41109224,40175383,40175384,42903089,42902374,41205378,40956236,36220150,40152687,40152688,44121393,36220151,36220152,36220153,36248769,19028950,35159338,35158426,35141413,35144635,35140952,35150822,19111540,35139664,35150042,35149235,42941598,42941599,35142345,35140864,35157582,35149353,44109828,44071162,44060026,44111472,44049577,42941597,19090659,35130898,35157675,35137925,35152854,42941602,19090660,35150373,35132779,35133014,40921621,35157321,35143167,35129573,35141909,35144637,19111541,35152583,35150372,35150991,35152706,40983949,42941603,42941604,35146684,35150484,35160199,35130984,44029688,44043760,36223695,36223696,36223697,36238935,36238936,36238937,36238938,19035396,41076011,43765498,43621596,43676005,43621597,43711629,43657853,43603675,43603676,43801525,43801526,43621598,43765499,43693728,43747547,40826364,41232447,41140437,40865527,40834392,40934295,40903091,41201389,19111674,43693727,19099295,19115326,41077675,19099296,19115328,19111133,40826365,36214651,36214652,36214653,36214654,19063387,36240968,36240969,36240970,36240972,36240973,36240974,36240975,789792,789793,1236744,43279458,43263090,41044406,41171422,40950892,40921352,40982025,41046072,40834057,40871010,41089500,41083637,40950893,41077462,43138188,43160356,43182255,43171260,43193194,43215079,41169787,41140254,41114852,40958610,41089509,41183355,40919752,40921354,41083639,41026797,40902030,41020852,35412649,35410325,35409770,35412896,35407647,35406876,40857434,41140253,40927345,40865162,40995737,41214687,21095485,21026819,40725799,40726334,40726331,40726333,40726332,40725798,40725797,21026820,21036612,21144583,21154512,21066067,21026821,21056242,35143912,1356243,1356245,40163421,40163422,35133536,1236772,21066064,36509721,36812271,21154510,44176710,21066066,21154511,21095484,21134694,21144582,21164327,21174109,44184151,21144581,21026818,43034253,40989871,40933221,41089499,41195220,40871009,40839868,41101240,41195219,36505941,41301760,40958607,41052052,41120718,40933220,41132549,41276573,41038475,43034853,42620619,41177370,41301761,41020849,41183353,41152312,41276576,36813716,43149132,43204226,43160359,43171262,36811466,36889383,43584404,36893867,43710416,42620783,41114851,41020853,40958609,40839876,41152318,41120728,1236767,40983674,41108884,41202830,40983673,36808441,36812395,41171421,41140250,41295738,40983672,40827811,35145040,35151001,41013309,41077461,40834061,40839875,41183354,41120727,41052055,41177371,19112110,19083153,43171261,41138691,41140251,41052054,41177369,41245606,41120721,1236773,41014896,40983677,40859070,43710415,21164326,40890380,40983676,41202832,41202831,40859069,41046073,41077460,40921353,41233878,41295739,40952528,40983675,41140252,42481922,41299179,42478939,44160781,43138186,36219301,36813480,36811710,36812414,36813815,36219302,1356244,1356246,36219303,36219304,36219305,40163426,40167341,40163430,40163432,40163440,40163444,40163445,40163448,40163452,40163453,40163454,36219299,36219300,36227922,35198052,35130476,35143557,35156091,35132506,35153625,35151937,35149265,35133367,35131026,35141815,35161627,35137458,35154275,35152712,35147767,36243175,36243176,36243178,36243179,36243180,36239350,36239351,36239995,36239996)

) I
) C
;

with primary_events (event_id, person_id, start_date, end_date, op_start_date, op_end_date, visit_occurrence_id) as
(
-- Begin Primary Events
select P.ordinal as event_id, P.person_id, P.start_date, P.end_date, op_start_date, op_end_date, cast(P.visit_occurrence_id as bigint) as visit_occurrence_id
FROM
(
  select E.person_id, E.start_date, E.end_date,
         row_number() OVER (PARTITION BY E.person_id ORDER BY E.sort_date ASC) ordinal,
         OP.observation_period_start_date as op_start_date, OP.observation_period_end_date as op_end_date, cast(E.visit_occurrence_id as bigint) as visit_occurrence_id
  FROM 
  (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.drug_exposure_start_date as start_date,
       COALESCE(C.DRUG_EXPOSURE_END_DATE, DATEADD(day,C.DAYS_SUPPLY,DRUG_EXPOSURE_START_DATE), DATEADD(day,1,C.DRUG_EXPOSURE_START_DATE)) as end_date,
       C.drug_concept_id as TARGET_CONCEPT_ID, C.visit_occurrence_id,
       C.drug_exposure_start_date as sort_date
from 
(
  select de.* 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets codesets on ((de.drug_concept_id = codesets.concept_id and codesets.codeset_id = 3))
) C


-- End Drug Exposure Criteria

  ) E
	JOIN @cdm_database_schema.observation_period OP on E.person_id = OP.person_id and E.start_date >=  OP.observation_period_start_date and E.start_date <= op.observation_period_end_date
  WHERE DATEADD(day,0,OP.OBSERVATION_PERIOD_START_DATE) <= E.START_DATE AND DATEADD(day,0,E.START_DATE) <= OP.OBSERVATION_PERIOD_END_DATE
) P

-- End Primary Events

)
SELECT event_id, person_id, start_date, end_date, op_start_date, op_end_date, visit_occurrence_id
INTO #qualified_events
FROM 
(
  select pe.event_id, pe.person_id, pe.start_date, pe.end_date, pe.op_start_date, pe.op_end_date, row_number() over (partition by pe.person_id order by pe.start_date ASC) as ordinal, cast(pe.visit_occurrence_id as bigint) as visit_occurrence_id
  FROM primary_events pe
  
) QE

;

--- Inclusion Rule Inserts

create table #inclusion_events (inclusion_rule_id bigint,
	person_id bigint,
	event_id bigint
);

with cteIncludedEvents(event_id, person_id, start_date, end_date, op_start_date, op_end_date, ordinal) as
(
  SELECT event_id, person_id, start_date, end_date, op_start_date, op_end_date, row_number() over (partition by person_id order by start_date ASC) as ordinal
  from
  (
    select Q.event_id, Q.person_id, Q.start_date, Q.end_date, Q.op_start_date, Q.op_end_date, SUM(coalesce(POWER(cast(2 as bigint), I.inclusion_rule_id), 0)) as inclusion_rule_mask
    from #qualified_events Q
    LEFT JOIN #inclusion_events I on I.person_id = Q.person_id and I.event_id = Q.event_id
    GROUP BY Q.event_id, Q.person_id, Q.start_date, Q.end_date, Q.op_start_date, Q.op_end_date
  ) MG -- matching groups

)
select event_id, person_id, start_date, end_date, op_start_date, op_end_date
into #included_events
FROM cteIncludedEvents Results

;

-- custom era strategy

with ctePersons(person_id) as (
	select distinct person_id from #included_events
)

select person_id, drug_exposure_start_date, drug_exposure_end_date
INTO #drugTarget
FROM (
	select de.PERSON_ID, DRUG_EXPOSURE_START_DATE, COALESCE(DRUG_EXPOSURE_END_DATE, DATEADD(day,DAYS_SUPPLY,DRUG_EXPOSURE_START_DATE), DATEADD(day,1,DRUG_EXPOSURE_START_DATE)) as DRUG_EXPOSURE_END_DATE 
	FROM @cdm_database_schema.DRUG_EXPOSURE de
	JOIN ctePersons p on de.person_id = p.person_id
	JOIN #Codesets cs on cs.codeset_id = 3 AND de.drug_concept_id = cs.concept_id

	UNION ALL

	select de.PERSON_ID, DRUG_EXPOSURE_START_DATE, COALESCE(DRUG_EXPOSURE_END_DATE, DATEADD(day,DAYS_SUPPLY,DRUG_EXPOSURE_START_DATE), DATEADD(day,1,DRUG_EXPOSURE_START_DATE)) as DRUG_EXPOSURE_END_DATE 
	FROM @cdm_database_schema.DRUG_EXPOSURE de
	JOIN ctePersons p on de.person_id = p.person_id
	JOIN #Codesets cs on cs.codeset_id = 3 AND de.drug_source_concept_id = cs.concept_id
) E
;

select et.event_id, et.person_id, ERAS.era_end_date as end_date
INTO #strategy_ends
from #included_events et
JOIN 
(
  select ENDS.person_id, min(drug_exposure_start_date) as era_start_date, DATEADD(day,0, ENDS.era_end_date) as era_end_date
  from
  (
    select de.person_id, de.drug_exposure_start_date, MIN(e.END_DATE) as era_end_date
    FROM #drugTarget DE
    JOIN 
    (
      --cteEndDates
      select PERSON_ID, DATEADD(day,-1 * 30,EVENT_DATE) as END_DATE -- unpad the end date by 30
      FROM
      (
				select PERSON_ID, EVENT_DATE, EVENT_TYPE, 
				MAX(START_ORDINAL) OVER (PARTITION BY PERSON_ID ORDER BY event_date, event_type ROWS UNBOUNDED PRECEDING) AS start_ordinal,
				ROW_NUMBER() OVER (PARTITION BY PERSON_ID ORDER BY EVENT_DATE, EVENT_TYPE) AS OVERALL_ORD -- this re-numbers the inner UNION so all rows are numbered ordered by the event date
				from
				(
					-- select the start dates, assigning a row number to each
					Select PERSON_ID, DRUG_EXPOSURE_START_DATE AS EVENT_DATE, 0 as EVENT_TYPE, ROW_NUMBER() OVER (PARTITION BY PERSON_ID ORDER BY DRUG_EXPOSURE_START_DATE) as START_ORDINAL
					from #drugTarget D

					UNION ALL

					-- add the end dates with NULL as the row number, padding the end dates by 30 to allow a grace period for overlapping ranges.
					select PERSON_ID, DATEADD(day,30,DRUG_EXPOSURE_END_DATE), 1 as EVENT_TYPE, NULL
					FROM #drugTarget D
				) RAWDATA
      ) E
      WHERE 2 * E.START_ORDINAL - E.OVERALL_ORD = 0
    ) E on DE.PERSON_ID = E.PERSON_ID and E.END_DATE >= DE.DRUG_EXPOSURE_START_DATE
    GROUP BY de.person_id, de.drug_exposure_start_date
  ) ENDS
  GROUP BY ENDS.person_id, ENDS.era_end_date
) ERAS on ERAS.person_id = et.person_id 
WHERE et.start_date between ERAS.era_start_date and ERAS.era_end_date;

TRUNCATE TABLE #drugTarget;
DROP TABLE #drugTarget;


-- generate cohort periods into #final_cohort
with cohort_ends (event_id, person_id, end_date) as
(
	-- cohort exit dates
  -- By default, cohort exit at the event's op end date
select event_id, person_id, op_end_date as end_date from #included_events
UNION ALL
-- End Date Strategy
SELECT event_id, person_id, end_date from #strategy_ends

),
first_ends (person_id, start_date, end_date) as
(
	select F.person_id, F.start_date, F.end_date
	FROM (
	  select I.event_id, I.person_id, I.start_date, E.end_date, row_number() over (partition by I.person_id, I.event_id order by E.end_date) as ordinal 
	  from #included_events I
	  join cohort_ends E on I.event_id = E.event_id and I.person_id = E.person_id and E.end_date >= I.start_date
	) F
	WHERE F.ordinal = 1
)
select person_id, start_date, end_date
INTO #cohort_rows
from first_ends;

with cteEndDates (person_id, end_date) AS -- the magic
(	
	SELECT
		person_id
		, DATEADD(day,-1 * 30, event_date)  as end_date
	FROM
	(
		SELECT
			person_id
			, event_date
			, event_type
			, MAX(start_ordinal) OVER (PARTITION BY person_id ORDER BY event_date, event_type ROWS UNBOUNDED PRECEDING) AS start_ordinal 
			, ROW_NUMBER() OVER (PARTITION BY person_id ORDER BY event_date, event_type) AS overall_ord
		FROM
		(
			SELECT
				person_id
				, start_date AS event_date
				, -1 AS event_type
				, ROW_NUMBER() OVER (PARTITION BY person_id ORDER BY start_date) AS start_ordinal
			FROM #cohort_rows
		
			UNION ALL
		

			SELECT
				person_id
				, DATEADD(day,30,end_date) as end_date
				, 1 AS event_type
				, NULL
			FROM #cohort_rows
		) RAWDATA
	) e
	WHERE (2 * e.start_ordinal) - e.overall_ord = 0
),
cteEnds (person_id, start_date, end_date) AS
(
	SELECT
		 c.person_id
		, c.start_date
		, MIN(e.end_date) AS end_date
	FROM #cohort_rows c
	JOIN cteEndDates e ON c.person_id = e.person_id AND e.end_date >= c.start_date
	GROUP BY c.person_id, c.start_date
)
select person_id, min(start_date) as start_date, end_date
into #final_cohort
from cteEnds
group by person_id, end_date
;

DELETE FROM @target_database_schema.@target_cohort_table where cohort_definition_id = @target_cohort_id;
INSERT INTO @target_database_schema.@target_cohort_table (cohort_definition_id, subject_id, cohort_start_date, cohort_end_date)
select @target_cohort_id as cohort_definition_id, person_id, start_date, end_date 
FROM #final_cohort CO
;



TRUNCATE TABLE #strategy_ends;
DROP TABLE #strategy_ends;


TRUNCATE TABLE #cohort_rows;
DROP TABLE #cohort_rows;

TRUNCATE TABLE #final_cohort;
DROP TABLE #final_cohort;

TRUNCATE TABLE #inclusion_events;
DROP TABLE #inclusion_events;

TRUNCATE TABLE #qualified_events;
DROP TABLE #qualified_events;

TRUNCATE TABLE #included_events;
DROP TABLE #included_events;

TRUNCATE TABLE #Codesets;
DROP TABLE #Codesets;